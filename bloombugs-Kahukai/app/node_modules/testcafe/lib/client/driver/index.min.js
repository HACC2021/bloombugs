window["%hammerhead%"].utils.removeInjectedScript(),function Mc(Ac){var Pc=Ac.document;!function(l,e,y,_,n){var o="default"in l?l.default:l;e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var t="default"in y?y.default:y,i="default"in n?n.default:n,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function c(t,s,a,l){return new(a=a||e)(function(n,e){function r(t){try{o(l.next(t))}catch(t){e(t)}}function i(t){try{o(l.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((l=l.apply(t,s||[])).next())})}function u(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var a,d,h=Math.floor(399);(d=a=a||{}).ready="ready",d.readyForBrowserManipulation="ready-for-browser-manipulation",d.waitForFileDownload="wait-for-file-download";var f=a,m={dispatchEvent:"dispatch-event",click:"click",rightClick:"right-click",doubleClick:"double-click",drag:"drag",dragToElement:"drag-to-element",hover:"hover",scroll:"scroll",scrollBy:"scroll-by",scrollIntoView:"scroll-into-view",typeText:"type-text",selectText:"select-text",selectTextAreaContent:"select-text-area-content",selectEditableContent:"select-editable-content",pressKey:"press-key",wait:"wait",navigateTo:"navigate-to",setFilesToUpload:"set-files-to-upload",clearUpload:"clear-upload",executeClientFunction:"execute-client-function",executeSelector:"execute-selector",takeScreenshot:"take-screenshot",takeElementScreenshot:"take-element-screenshot",takeScreenshotOnFail:"take-screenshot-on-fail",prepareBrowserManipulation:"prepare-browser-manipulation",showAssertionRetriesStatus:"show-assertion-retries-status",hideAssertionRetriesStatus:"hide-assertion-retries-status",setBreakpoint:"set-breakpoint",resizeWindow:"resize-window",resizeWindowToFitDevice:"resize-window-to-fit-device",maximizeWindow:"maximize-window",switchToIframe:"switch-to-iframe",switchToMainWindow:"switch-to-main-window",openWindow:"open-window",closeWindow:"close-window",getCurrentWindow:"get-current-window",getCurrentWindows:"get-current-windows",switchToWindow:"switch-to-window",switchToWindowByPredicate:"switch-to-window-by-predicate",switchToParentWindow:"switch-to-parent-window",switchToPreviousWindow:"switch-to-previous-window",setNativeDialogHandler:"set-native-dialog-handler",getNativeDialogHistory:"get-native-dialog-history",getBrowserConsoleMessages:"get-browser-console-messages",getActiveElement:"get-active-element",setTestSpeed:"set-test-speed",setPageLoadTimeout:"set-page-load-timeout",debug:"debug",disableDebug:"disable-debug",assertion:"assertion",useRole:"useRole",testDone:"test-done",backupStorages:"backup-storages",executeExpression:"execute-expression",executeAsyncExpression:"execute-async-expression",unlockPage:"unlock-page",recorder:"recorder"},p="E1",g="E4",v="E5",w="E9",E="E10",C="E11",S="E12",I="E24",T="E26",b="E27",x="E28",W="E29",M="E30",A="E31",P="E32",D="E33",R="E34",N="E35",k="E36",F="E37",L="E39",U="E40",O="E41",B="E42",H="E43",G="E44",V="E45",X="E46",Y="E49",z="E50",j="E51",q="E52",K="E57",J="E64",$="E65",Q="E68",Z="E69",tt="E70",et="E71",nt="E72",rt="E73",it="E74",ot="E76",st="E77",at="E78",lt="E82",ct="E83";function ut(t){return!(function(t){return t.type===m.executeClientFunction||t.type===m.executeSelector}(r=t)||r.type===m.wait||r.type===m.assertion||r.type===m.executeExpression||ht(t)||(n=t).type===m.testDone||n.type===m.showAssertionRetriesStatus||n.type===m.hideAssertionRetriesStatus||n.type===m.setBreakpoint||n.type===m.takeScreenshotOnFail||n.type===m.recorder)||dt(t)&&!((e=t).type===m.switchToIframe||e.type===m.switchToMainWindow);var e,n,r}function dt(t){return t.type===m.resizeWindow||t.type===m.resizeWindowToFitDevice||t.type===m.maximizeWindow}function ht(t){return(e=t).type===m.takeScreenshot||e.type===m.takeElementScreenshot||e.type===m.takeScreenshotOnFail||dt(t);var e}function ft(t,e){this.code=t,this.isTestCafeError=!0,this.callsite=e||null}var mt,pt="step",gt=(s(vt,mt=ft),vt);function vt(t,e,n){var r=mt.call(this,t)||this;return r.optionName=e,r.actualValue=n,r}var wt,yt=(s(_t,wt=ft),_t);function _t(t,e){var n=wt.call(this,Y,e)||this;return n.instantiationCallsiteName=t,n}var Et,Ct=(s(St,Et=ft),St);function St(t,e){var n=Et.call(this,z,e)||this;return n.instantiationCallsiteName=t,n}var It,Tt=(s(bt,It=ft),bt);function bt(t,e){var n=e.apiFnChain,r=e.apiFnIndex,i=It.call(this,t)||this;return i.apiFnChain=n,i.apiFnIndex=r,i}var xt,Wt=(s(Mt,xt=ft),Mt);function Mt(t){return xt.call(this,j,t)||this}var At,Pt=(s(Dt,At=Tt),Dt);function Dt(t,e){var n=At.call(this,q,e)||this;return n.callsite=t,n}var Rt,Nt=(s(kt,Rt=ft),kt);function kt(t,e){var n=Rt.call(this,p)||this;return n.errStack=t,n.pageDestUrl=e,n}var Ft,Lt=(s(Ut,Ft=ft),Ut);function Ut(t,e,n){var r=Ft.call(this,g,n)||this;return r.errMsg=String(e),r.instantiationCallsiteName=t,r}var Ot,Bt=(s(Ht,Ot=ft),Ht);function Ht(t,e,n,r){var i=Ot.call(this,v,r)||this;return i.errMsg=String(e),i.property=n,i.instantiationCallsiteName=t,i}var Gt,Vt=(s(Xt,Gt=ft),Xt);function Xt(t){var e=Gt.call(this,J)||this;return e.errMsg=String(t),e}var Yt,zt=(s(jt,Yt=ft),jt);function jt(t,e){var n=Yt.call(this,$)||this;return n.errMsg=String(t),n.moduleName=e,n}var qt,Kt=(s(Jt,qt=gt),Jt);function Jt(t,e){return qt.call(this,w,t,e)||this}var $t,Qt=(s(Zt,$t=gt),Zt);function Zt(t,e){return $t.call(this,E,t,e)||this}var te,ee=(s(ne,te=gt),ne);function ne(t,e){return te.call(this,C,t,e)||this}var re,ie=(s(oe,re=gt),oe);function oe(t,e){return re.call(this,S,t,e)||this}var se,ae=(s(le,se=Tt),le);function le(t){return se.call(this,I,t)||this}var ce,ue=(s(de,ce=ft),de);function de(){return ce.call(this,T)||this}var he,fe=(s(me,he=ft),me);function me(t){var e=he.call(this,b)||this;return e.nodeDescription=t,e}var pe,ge=(s(ve,pe=Tt),ve);function ve(t,e){var n=pe.call(this,x,e)||this;return n.argumentName=t,n}var we,ye=(s(_e,we=ft),_e);function _e(t){var e=we.call(this,W)||this;return e.argumentName=t,e}var Ee,Ce=(s(Se,Ee=ft),Se);function Se(t,e){var n=Ee.call(this,M)||this;return n.argumentName=t,n.nodeDescription=e,n}var Ie,Te=(s(be,Ie=ft),be);function be(){return Ie.call(this,A)||this}var xe,We=(s(Me,xe=ft),Me);function Me(){return xe.call(this,P)||this}var Ae,Pe=(s(De,Ae=ft),De);function De(t){var e=Ae.call(this,D)||this;return e.argumentName=t,e}var Re,Ne=(s(ke,Re=ft),ke);function ke(){return Re.call(this,N)||this}var Fe,Le=(s(Ue,Fe=ft),Ue);function Ue(t){var e=Fe.call(this,k)||this;return e.argumentName=t,e}var Oe,Be=(s(He,Oe=ft),He);function He(t,e){var n=Oe.call(this,F)||this;return n.filePaths=t,n.scannedFilePaths=e,n}var Ge,Ve=(s(Xe,Ge=ft),Xe);function Xe(){return Ge.call(this,R)||this}var Ye,ze=(s(je,Ye=ft),je);function je(t,e){var n=Ye.call(this,O)||this;return n.properties=t?"scrollTargetY property":e?"scrollTargetX property":"scrollTargetX and scrollTargetY properties",n}var qe,Ke=(s(Je,qe=ft),Je);function Je(t,e){var n=qe.call(this,K)||this;return t<=0?e<=0?(n.verb="are",n.dimensions="width and height"):(n.verb="is",n.dimensions="width"):(n.verb="is",n.dimensions="height"),n}var $e,Qe=(s(Ze,$e=ft),Ze);function Ze(){return $e.call(this,U)||this}var tn,en=(s(nn,tn=ft),nn);function nn(){return tn.call(this,L)||this}var rn,on=(s(sn,rn=ft),sn);function sn(){return rn.call(this,B)||this}var an,ln=(s(cn,an=ft),cn);function cn(){return an.call(this,Z)||this}var un,dn=(s(hn,un=ft),hn);function hn(){return un.call(this,Q)||this}var fn,mn=(s(pn,fn=ft),pn);function pn(){return fn.call(this,tt)||this}var gn,vn=(s(wn,gn=ft),wn);function wn(){return gn.call(this,et)||this}var yn,_n=(s(En,yn=ft),En);function En(){return yn.call(this,rt)||this}var Cn,Sn,In=(s(Tn,Cn=ft),Tn);function Tn(){return Cn.call(this,lt)||this}function bn(t){var e=Sn.call(this,at)||this;return e.errMsg=t,e}s(bn,Sn=ft);var xn,Wn=(s(Mn,xn=ft),Mn);function Mn(){return xn.call(this,it)||this}var An,Pn=(s(Dn,An=ft),Dn);function Dn(){return An.call(this,ot)||this}var Rn,Nn=(s(kn,Rn=ft),kn);function kn(){return Rn.call(this,st)||this}var Fn,Ln=(s(Un,Fn=ft),Un);function Un(){return Fn.call(this,nt)||this}var On,Bn=(s(Hn,On=ft),Hn);function Hn(){return On.call(this,ct)||this}var Gn,Vn=(s(Xn,Gn=ft),Xn);function Xn(){return Gn.call(this,H)||this}var Yn,zn=(s(jn,Yn=ft),jn);function jn(){return Yn.call(this,G)||this}var qn,Kn=(s(Jn,qn=ft),Jn);function Jn(t,e){var n=qn.call(this,V)||this;return n.dialogType=t,n.pageUrl=e,n}var $n,Qn=(s(Zn,$n=ft),Zn);function Zn(t,e,n){var r=$n.call(this,X)||this;return r.dialogType=t,r.errMsg=e,r.pageUrl=n,r}var tr="_nativeMethods",er=(nr.prototype._ensureNativeMethods=function(t){return t||{objectKeys:Object.keys,arrayForEach:Array.prototype.forEach,arrayConcat:Array.prototype.concat,arraySlice:Array.prototype.slice,objectDefineProperty:Object.defineProperty}},nr.prototype._getWindowIds=function(t){return this[tr].objectKeys(t)},nr.prototype._copyArray=function(t){return this[tr].arraySlice.call(t)},nr.prototype._concatArrays=function(t,e){return this[tr].arrayConcat.call(t,e)},nr.prototype.ensureMessageContainer=function(t){this[t]||(this[t]={log:[],info:[],warn:[],error:[]})},nr.prototype.concat=function(e){var n=this;if(!e)return this;var t=this._getWindowIds(e);return this[tr].arrayForEach.call(t,function(t){n.ensureMessageContainer(t),n[t].log=n._concatArrays(n[t].log,e[t].log),n[t].info=n._concatArrays(n[t].info,e[t].info),n[t].warn=n._concatArrays(n[t].warn,e[t].warn),n[t].error=n._concatArrays(n[t].error,e[t].error)}),this},nr.prototype.addMessage=function(t,e,n){this.ensureMessageContainer(n),this[n][t].push(e)},nr.prototype.getCopy=function(){var e=this,n={},t=this._getWindowIds(this);return this[tr].arrayForEach.call(t,function(t){n[t]={log:e._copyArray(e[t].log),info:e._copyArray(e[t].info),warn:e._copyArray(e[t].warn),error:e._copyArray(e[t].error)}}),n},nr);function nr(t,e){var n=this._ensureNativeMethods(e);n.objectDefineProperty(this,tr,{value:n}),this.concat(t)}var rr,ir=(s(or,rr=er),or);function or(t){return rr.call(this,t,l.nativeMethods)||this}var sr,ar=(function(t){function n(t){return!!s[t]}function r(t,e){this.references=t,this.transforms=e,this.circularCandidates=[],this.circularCandidatesDescrs=[],this.circularRefCount=0}var o=/^#*@(t|r)$/,i=(0,eval)("this"),s={Int8Array:"function"==typeof Int8Array?Int8Array:void 0,Uint8Array:"function"==typeof Uint8Array?Uint8Array:void 0,Uint8ClampedArray:"function"==typeof Uint8ClampedArray?Uint8ClampedArray:void 0,Int16Array:"function"==typeof Int16Array?Int16Array:void 0,Uint16Array:"function"==typeof Uint16Array?Uint16Array:void 0,Int32Array:"function"==typeof Int32Array?Int32Array:void 0,Uint32Array:"function"==typeof Uint32Array?Uint32Array:void 0,Float32Array:"function"==typeof Float32Array?Float32Array:void 0,Float64Array:"function"==typeof Float64Array?Float64Array:void 0},a="function"==typeof ArrayBuffer,l="function"==typeof Map,c="function"==typeof Set,u="function"==typeof Buffer,d=Array.prototype.slice,e={serialize:function(t){return JSON.stringify(t)},deserialize:function(t){return JSON.parse(t)}};function h(t,e){this.references=t,this.transformMap=e,this.activeTransformsStack=[],this.visitedRefs=Object.create(null)}r._createRefMark=function(t){var e=Object.create(null);return e["@r"]=t,e},r.prototype._createCircularCandidate=function(t,e,n){this.circularCandidates.push(t),this.circularCandidatesDescrs.push({parent:e,key:n,refIdx:-1})},r.prototype._applyTransform=function(t,e,n,r){var i=Object.create(null),o=r.toSerializable(t);return"object"==typeof o&&this._createCircularCandidate(t,e,n),i["@t"]=r.type,i.data=this._handleValue(o,e,n),i},r.prototype._handleArray=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=this._handleValue(t[n],e,n);return e},r.prototype._handlePlainObject=function(n){var r=this,i=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){var e=o.test(t)?"#"+t:t;i[e]=r._handleValue(n[t],i,e)}),i},r.prototype._handleObject=function(t,e,n){return this._createCircularCandidate(t,e,n),Array.isArray(t)?this._handleArray(t):this._handlePlainObject(t)},r.prototype._ensureCircularReference=function(t){var e=this.circularCandidates.indexOf(t);if(-1<e){var n=this.circularCandidatesDescrs[e];return-1===n.refIdx&&(n.refIdx=n.parent?++this.circularRefCount:0),r._createRefMark(n.refIdx)}return null},r.prototype._handleValue=function(t,e,n){var r=typeof t,i="object"==r&&null!==t;if(i){var o=this._ensureCircularReference(t);if(o)return o}for(var s=0;s<this.transforms.length;s++){var a=this.transforms[s];if(a.shouldTransform(r,t))return this._applyTransform(t,e,n,a)}return i?this._handleObject(t,e,n):t},r.prototype.transform=function(){for(var t=[this._handleValue(this.references,null,null)],e=0;e<this.circularCandidatesDescrs.length;e++){var n=this.circularCandidatesDescrs[e];0<n.refIdx&&(t[n.refIdx]=n.parent[n.key],n.parent[n.key]=r._createRefMark(n.refIdx))}return t},h.prototype._handlePlainObject=function(e){var t,n=this,r=Object.create(null),i=Object.getOwnPropertyNames(e);for(t in i.forEach(function(t){n._handleValue(e[t],e,t),o.test(t)&&(r[t.substring(1)]=e[t],delete e[t])}),r)e[t]=r[t]},h.prototype._handleTransformedObject=function(t,e,n){var r=t["@t"],i=this.transformMap[r];if(!i)throw new Error("Can't find transform for \""+r+'" type.');this.activeTransformsStack.push(t),this._handleValue(t.data,t,"data"),this.activeTransformsStack.pop(),e[n]=i.fromSerializable(t.data)},h.prototype._handleCircularSelfRefDuringTransform=function(t,e,n){var r=this.references,i=void 0;Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){return void 0===i&&(i=r[t]),i},set:function(t){return i=t}})},h.prototype._handleCircularRef=function(t,e,n){-1<this.activeTransformsStack.indexOf(this.references[t])?this._handleCircularSelfRefDuringTransform(t,e,n):(this.visitedRefs[t]||(this.visitedRefs[t]=!0,this._handleValue(this.references[t],this.references,t)),e[n]=this.references[t])},h.prototype._handleValue=function(t,e,n){if("object"==typeof t&&null!==t){var r=t["@r"];if(void 0!==r)this._handleCircularRef(r,e,n);else if(t["@t"])this._handleTransformedObject(t,e,n);else if(Array.isArray(t))for(var i=0;i<t.length;i++)this._handleValue(t[i],t,i);else this._handlePlainObject(t)}},h.prototype.transform=function(){return this.visitedRefs[0]=!0,this._handleValue(this.references[0],this.references,0),this.references[0]};var f=[{type:"[[NaN]]",shouldTransform:function(t,e){return"number"===t&&isNaN(e)},toSerializable:function(){return""},fromSerializable:function(){return NaN}},{type:"[[undefined]]",shouldTransform:function(t){return"undefined"===t},toSerializable:function(){return""},fromSerializable:function(){}},{type:"[[Date]]",shouldTransform:function(t,e){return e instanceof Date},toSerializable:function(t){return t.getTime()},fromSerializable:function(t){var e=new Date;return e.setTime(t),e}},{type:"[[RegExp]]",shouldTransform:function(t,e){return e instanceof RegExp},toSerializable:function(t){var e={src:t.source,flags:""};return t.global&&(e.flags+="g"),t.ignoreCase&&(e.flags+="i"),t.multiline&&(e.flags+="m"),e},fromSerializable:function(t){return new RegExp(t.src,t.flags)}},{type:"[[Error]]",shouldTransform:function(t,e){return e instanceof Error},toSerializable:function(t){return{name:t.name,message:t.message,stack:t.stack}},fromSerializable:function(t){var e=new(i[t.name]||Error)(t.message);return e.stack=t.stack,e}},{type:"[[ArrayBuffer]]",shouldTransform:function(t,e){return a&&e instanceof ArrayBuffer},toSerializable:function(t){var e=new Int8Array(t);return d.call(e)},fromSerializable:function(t){if(a){var e=new ArrayBuffer(t.length);return new Int8Array(e).set(t),e}return t}},{type:"[[Buffer]]",shouldTransform:function(t,e){return u&&e instanceof Buffer},toSerializable:function(t){return d.call(t)},fromSerializable:function(t){return u?Buffer.from(t):t}},{type:"[[TypedArray]]",shouldTransform:function(t,e){return Object.keys(s).some(function(t){return n(t)&&e instanceof s[t]})},toSerializable:function(t){return{ctorName:t.constructor.name,arr:d.call(t)}},fromSerializable:function(t){return n(t.ctorName)?new s[t.ctorName](t.arr):t.arr}},{type:"[[Map]]",shouldTransform:function(t,e){return l&&e instanceof Map},toSerializable:function(t){var n=[];return t.forEach(function(t,e){n.push(e),n.push(t)}),n},fromSerializable:function(t){if(l){for(var e=new Map,n=0;n<t.length;n+=2)e.set(t[n],t[n+1]);return e}for(var r=[],i=0;i<t.length;i+=2)r.push([t[n],t[n+1]]);return r}},{type:"[[Set]]",shouldTransform:function(t,e){return c&&e instanceof Set},toSerializable:function(t){var e=[];return t.forEach(function(t){e.push(t)}),e},fromSerializable:function(t){if(c){for(var e=new Set,n=0;n<t.length;n++)e.add(t[n]);return e}return t}}],m=t.exports=function(t){this.transforms=[],this.transformsMap=Object.create(null),this.serializer=t||e,this.addTransforms(f)};m.prototype.addTransforms=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++){var n=t[e];if(this.transformsMap[n.type])throw new Error('Transform with type "'+n.type+'" was already added.');this.transforms.push(n),this.transformsMap[n.type]=n}return this},m.prototype.removeTransforms=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++){var n=t[e],r=this.transforms.indexOf(n);-1<r&&this.transforms.splice(r,1),delete this.transformsMap[n.type]}return this},m.prototype.encode=function(t){var e=new r(t,this.transforms).transform();return this.serializer.serialize(e)},m.prototype.decode=function(t){var e=this.serializer.deserialize(t);return new h(e,this.transformsMap).transform()}}(sr={exports:{}}),sr.exports),lr=function(t){return t};function cr(t){return new ar({serialize:lr,deserialize:lr}).addTransforms(t)}var ur,dr={};function hr(t){return!(!dr.isDomElement(t)&&!dr.isTextNode(t))&&(dr.isOptionElement(t)||"optgroup"===dr.getTagName(t)?dr.isOptionElementVisible(t):dr.isElementVisible(t))}var fr=1,mr=2,pr=3,gr=((ur={})[fr]=/^\.filterVisible\(\)$/,ur[mr]=/^\.filterHidden\(\)$/,ur[pr]=/^\.nth\(\d+\)$/,ur);function vr(){this._err=null}var wr=(Object.defineProperty(vr.prototype,"error",{get:function(){return this._err},set:function(t){null===this._err&&(this._err=t)},enumerable:!1,configurable:!0}),vr.prototype.filter=function(t,e,n){if(e.filterVisible&&(t=t.filter(hr),this._assertFilterError(t,n,fr)),e.filterHidden&&(t=t.filter(function(t){return!hr(t)}),this._assertFilterError(t,n,mr)),e.counterMode)return null===e.index?t.length:vr._getNodeByIndex(t,e.index)?1:0;var r;if(e.collectionMode)return null!==e.index&&(t=(r=vr._getNodeByIndex(t,e.index))?[r]:[],this._assertFilterError(t,n,pr)),t;var i=vr._getNodeByIndex(t,e.index||0);return i||(this.error=vr._getErrorItem(n,pr)),i},vr.prototype.cast=function(t){if(null==t)return[];if(t instanceof dr.nativeMethods.Node)return[t];if(function(t){if(dr.nativeMethods.isArray(t)){for(var e=0;e<t.length;e++)if(!(t[e]instanceof dr.nativeMethods.Node))return;return 1}}(t))return t;if((e=t)instanceof dr.nativeMethods.HTMLCollection||e instanceof dr.nativeMethods.NodeList)return function(t){for(var e=t.length,n=[],r=0;r<e;r++)n.push(t[r]);return n}(t);var e;throw new Wt},vr.prototype._assertFilterError=function(t,e,n){0===t.length&&(this.error=vr._getErrorItem(e,n))},vr._getErrorItem=function(t,e){var n=t.apiFnChain,r=t.apiFnID;if(e)for(var i=r;i<n.length;i++)if(gr[e].test(n[i]))return i;return null},vr._getNodeByIndex=function(t,e){return e<0?t[t.length+e]:t[e]},new vr);function yr(t,e){var n=dr.nativeMethods.Function;return dr.isProxyless?new n("fnCode","__dependencies$",'"use strict"; return eval(fnCode)')(t,e):new n("fnCode","__dependencies$","Promise","RegExp",'"use strict"; return eval(fnCode)')(t,e,dr.PromiseCtor,RegExp)}var _r=(Er.prototype.shouldTransform=function(t){return"function"===t},Er.prototype.toSerializable=function(){return""},Er.prototype.fromSerializable=function(t){var e=t.fnCode,n=t.dependencies;return"filterOptions"in n&&(n.selectorFilter=wr),yr(e,n)},Er);function Er(){this.type="Function"}var Cr=(Sr.prototype.shouldTransform=function(t,e){if(e instanceof dr.nativeMethods.Node)throw new Ct(this._instantiationCallsiteName);return!1},Sr.prototype.toSerializable=function(){},Sr.prototype.fromSerializable=function(){},Sr);function Sr(t){this.type="Node",this._instantiationCallsiteName=t}var Ir=(Tr.prototype.getResult=function(){var e=this;return dr.PromiseCtor.resolve().then(function(){var t=e.replicator.decode(e.command.args);return e._executeFn(t)}).catch(function(t){throw t.isTestCafeError||dr.isProxyless||(t=new Lt(e.command.instantiationCallsiteName,t)),t})},Tr.prototype.encodeResult=function(t){return this.replicator.encode(t)},Tr.prototype._createReplicator=function(){return cr([new Cr(this.command.instantiationCallsiteName),new _r])},Tr.prototype._executeFn=function(t){return this.fn.apply(Ac,t)},Tr);function Tr(t){this.command=t,this.replicator=this._createReplicator(),this.dependencies=this.replicator.decode(t.dependencies),this.fn=yr(t.fnCode,this.dependencies)}var br="appeared-dialog",xr="unexpected-dialog",Wr="handler-error",Mr=o.eventSandbox.message,Ar=o.processScript,Pr=o.nativeMethods,Dr="testcafe|native-dialog-tracker|appeared-dialogs",Rr="testcafe|native-dialog-tracker|unexpected-dialog",Nr="testcafe|native-dialog-tracker|error-in-handler",kr=Ar("window.location.href"),Fr=(Object.defineProperty(Lr.prototype,"appearedDialogs",{get:function(){var t=this.contextStorage.getItem(Dr);return t||(t=[],this.appearedDialogs=t),t},set:function(t){this.contextStorage.setItem(Dr,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Lr.prototype,"unexpectedDialog",{get:function(){return this.contextStorage.getItem(Rr)},set:function(t){this.contextStorage.setItem(Rr,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Lr.prototype,"handlerError",{get:function(){return this.contextStorage.getItem(Nr)},set:function(t){this.contextStorage.setItem(Nr,t)},enumerable:!1,configurable:!0}),Lr._getPageUrl=function(){return Pr.eval(kr)},Lr.prototype._initListening=function(){var n=this;Mr.on(Mr.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message;e.type===br?n._addAppearedDialogs(e.dialogType,e.text,e.url):e.type!==xr||n.unexpectedDialog?e.type!==Wr||n.handlerError||n._onHandlerError(e.dialogType,e.message,e.url):n.unexpectedDialog={type:e.dialogType,url:e.url}})},Lr.prototype._init=function(){var e=this;o.on(o.EVENTS.beforeUnload,function(t){t.prevented&&!t.isFakeIEEvent&&(e.dialogHandler?e._createDialogHandler("beforeunload")(t.returnValue||""):e._defaultDialogHandler("beforeunload")),e.contextStorage&&e.contextStorage.save()}),Ac.alert=function(){return e._defaultDialogHandler("alert")},Ac.confirm=function(){return e._defaultDialogHandler("confirm")},Ac.prompt=function(){return e._defaultDialogHandler("prompt")}},Lr.prototype._createDialogHandler=function(i){var o=this;return function(t){var e=Lr._getPageUrl();o._addAppearedDialogs(i,t,e);var n=new Ir(o.dialogHandler),r=null;try{r=n.fn.apply(Ac,[i,t,e])}catch(t){o._onHandlerError(i,t.message||String(t),e)}return r}},Lr.prototype._defaultDialogHandler=function(t){var e=Lr._getPageUrl();this.unexpectedDialog=this.unexpectedDialog||{type:t,url:e}},Lr.prototype._addAppearedDialogs=function(t,e,n){this.appearedDialogs.splice(0,0,{type:t,text:e,url:n})},Lr.prototype._onHandlerError=function(t,e,n){this.handlerError=this.handlerError||{type:t,message:e,url:n}},Lr.prototype.setHandler=function(t){var e=this;this.dialogHandler=t,["alert","confirm","prompt"].forEach(function(t){Ac[t]=e.dialogHandler?e._createDialogHandler(t):function(){return e._defaultDialogHandler(t)}})},Lr.prototype.getUnexpectedDialogError=function(){var t=this.unexpectedDialog,e=this.handlerError;return this.unexpectedDialog=null,this.handlerError=null,t?new Kn(t.type,t.url):e?new Qn(e.type,e.message,e.url):null},Lr);function Lr(t,e){this.contextStorage=t,this.dialogHandler=e,this._init(),this._initListening(),this.dialogHandler&&this.setHandler(e)}function Ur(){return l.nativeMethods.performanceNow().toString()}function Or(t){this.type=t,this.id=Ur()}var Br,Hr="driver|establish-connection",Gr="driver|switch-to-window",Vr="driver|close-window",Xr="driver|close-window-validation",Yr="driver|switch-to-window-validation",zr="driver|get-windows",jr="driver|command-executed",qr="driver|execute-command",Kr="driver|confirmation",Jr="driver|set-native-dialog-handler",$r="driver|set-as-master",Qr="driver|close-all-child-windows",Zr="driver|start-to-restore-child-link",ti="driver|restore-child-link",ei="driver|child-window-is-loaded-in-iframe",ni="driver|child-window-is-opened-in-iframe",ri="driver|has-pending-action-flags",ii=(s(oi,Br=Or),oi);function oi(){return Br.call(this,Hr)||this}var si,ai=(s(li,si=Or),li);function li(t){var e=t.windowId,n=si.call(this,Xr)||this;return n.windowId=e,n}var ci,ui=(s(di,ci=Or),di);function di(t){var e=t.windowId,n=t.fn,r=ci.call(this,Yr)||this;return r.windowId=e,r.fn=n,r}var hi,fi=(s(mi,hi=Or),mi);function mi(){return hi.call(this,zr)||this}var pi,gi=(s(vi,pi=Or),vi);function vi(t){var e=t.windowId,n=t.isCurrentWindow,r=pi.call(this,Vr)||this;return r.windowId=e,r.isCurrentWindow=n,r}var wi,yi=(s(_i,wi=Or),_i);function _i(t){var e=t.windowId,n=t.fn,r=wi.call(this,Gr)||this;return r.windowId=e,r.fn=n,r}var Ei,Ci=(s(Si,Ei=Or),Si);function Si(t){var e=Ei.call(this,jr)||this;return e.driverStatus=t,e}var Ii,Ti=(s(bi,Ii=Or),bi);function bi(t,e){var n=Ii.call(this,qr)||this;return n.command=t,n.testSpeed=e,n}var xi,Wi=(s(Mi,xi=Or),Mi);function Mi(t,e){var n=xi.call(this,Kr)||this;return n.requestMessageId=t,n.result=e,n}var Ai,Pi=(s(Di,Ai=Or),Di);function Di(t){var e=Ai.call(this,Jr)||this;return e.dialogHandler=t,e}var Ri,Ni=(s(ki,Ri=Or),ki);function ki(t){var e=Ri.call(this,$r)||this;return e.finalizePendingCommand=t,e}var Fi,Li=(s(Ui,Fi=Or),Ui);function Ui(){return Fi.call(this,Qr)||this}var Oi,Bi=(s(Hi,Oi=Or),Hi);function Hi(){return Oi.call(this,Zr)||this}var Gi,Vi=(s(Xi,Gi=Or),Xi);function Xi(t){var e=Gi.call(this,ti)||this;return e.windowId=t,e}var Yi,zi=(s(ji,Yi=Or),ji);function ji(t){var e=Yi.call(this,ei)||this;return e.windowId=t,e}var qi,Ki=(s(Ji,qi=Or),Ji);function Ji(){return qi.call(this,ni)||this}var $i,Qi=(s(Zi,$i=Or),Zi);function Zi(){return $i.call(this,ri)||this}var to=o.json,eo=o.nativeMethods,no=(ro.prototype._createStorageKey=function(t,e){var n="testcafe|driver|"+t;return e?n+"|"+e:n},ro.prototype._loadFromStorage=function(){var t=eo.storageGetItem.call(this.storage,this.storageKey);t&&(this.data=to.parse(t),eo.storageRemoveItem.call(this.storage,this.storageKey))},ro.prototype.save=function(){eo.storageSetItem.call(this.storage,this.storageKey,to.stringify(this.data))},ro.prototype.setItem=function(t,e){this.data[t]=e,this.save()},ro.prototype.getItem=function(t){return this.data[t]},ro.prototype.dispose=function(){eo.storageRemoveItem.call(this.storage,this.storageKey)},ro);function ro(t,e,n){this.storage=eo.winSessionStorageGetter.call(t),this.storageKey=this._createStorageKey(e,n),this.data={},this._loadFromStorage()}var io=(oo.prototype._getAssignableProperties=function(){throw new Error("Not implemented")},oo.prototype._assignFrom=function(t,e,n){if(void 0===n&&(n={}),t)for(var r=this._getAssignableProperties(),i=0;i<r.length;i++){for(var o,s=r[i],a=s.name,l=s.type,c=s.required,u=s.init,d=s.defaultValue,h=a.split("."),f=h.length-1,m=h[f],p=t,g=this,v=0;v<f&&p&&g;v++)p=p[h[v]],g=g[h[v]];g&&"defaultValue"in r[i]&&(g[a]=d),p&&g&&(void 0===(o=p[m])&&!c||(e&&l&&l(a,o),g[m]=u?u(a,o,n,e):o))}},oo);function oo(){}var so,ao=(s(lo,so=io),lo.prototype._getAssignableProperties=function(){return[{name:"isCommandResult"},{name:"executionError"},{name:"pageError"},{name:"result"},{name:"consoleMessages"},{name:"isPendingWindowSwitching"},{name:"isFirstRequestAfterWindowSwitching"}]},lo);function lo(t){var e=so.call(this,t)||this;return e.id=Ur(),e.isCommandResult=!1,e.executionError=null,e.pageError=null,e.resent=!1,e.result=null,e.consoleMessages=null,e.isPendingWindowSwitching=!1,e.isFirstRequestAfterWindowSwitching=!1,e.debug="",e._assignFrom(t,!0),e}function co(n,t,e,r){var i=null,o=null,s=null;return e=Math.max(e||0,2500),l.Promise.race([y.delay(e),new l.Promise(function(e){s=function(t){t.message.type===Kr&&t.message.requestMessageId===n.id&&e(t.message)},l.eventSandbox.message.on(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),i=l.nativeMethods.setInterval.call(Ac,function(){return l.eventSandbox.message.sendServiceMsg(n,t)},1e3),l.eventSandbox.message.sendServiceMsg(n,t)})]).then(function(t){if(l.nativeMethods.clearInterval.call(Ac,i),l.nativeMethods.clearTimeout.call(Ac,o),l.eventSandbox.message.off(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),!t)throw new r;return t})}var uo=2e4;function ho(t){var e=t.requestMsgId,n=t.result,r=t.window,i=new Wi(e,n);l.eventSandbox.message.sendServiceMsg(i,r)}var fo=(Object.defineProperty(mo.prototype,"availabilityTimeout",{set:function(t){this.iframeAvailabilityTimeout=t},enumerable:!1,configurable:!0}),mo.prototype._ensureIframe=function(){var t=this;return y.domUtils.isElementInDocument(this.driverIframe)?y.waitFor(function(){return y.positionUtils.isElementVisible(t.driverIframe)?t.driverIframe:null},200,this.iframeAvailabilityTimeout).catch(function(){throw new zn}):l.Promise.reject(new Vn)},mo.prototype._waitForIframeRemovedOrHidden=function(){var e=this;return new l.Promise(function(t){e.checkIframeInterval=l.nativeMethods.setInterval.call(Ac,function(){e._ensureIframe().catch(function(){return y.delay(500).then(function(){return t(new ao({isCommandResult:!0}))})})},1e3)})},mo.prototype._waitForCommandResult=function(){var e=this,n=null;return l.Promise.race([this._waitForIframeRemovedOrHidden(),new l.Promise(function(e){n=function(t){t.message.type===jr&&e(t.message.driverStatus)},l.eventSandbox.message.on(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n)})]).then(function(t){return l.eventSandbox.message.off(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n),l.nativeMethods.clearInterval.call(Ac,e.checkIframeInterval),t})},mo.prototype.sendConfirmationMessage=function(t){ho({requestMsgId:t,result:{id:this.driverId},window:this.driverWindow})},mo.prototype.executeCommand=function(e,n){var r=this;return this._ensureIframe().then(function(){var t=new Ti(e,n);return l.Promise.all([co(t,r.driverWindow,r.iframeAvailabilityTimeout,on),r._waitForCommandResult()])}).then(function(t){return t[1]})},mo);function mo(t,e){this.driverWindow=t,this.driverIframe=y.domUtils.findIframeByWindow(t),this.driverId=e,this.iframeAvailabilityTimeout=0}var po=["nodeType","textContent","childNodeCount","hasChildNodes","childElementCount","hasChildElements"],go=["tagName","attributes"],vo=["tagName","visible","focused","attributes","boundingClientRect","classNames","style","innerText","namespaceURI","id","value","checked","selected","selectedIndex","scrollWidth","scrollHeight","scrollLeft","scrollTop","offsetWidth","offsetHeight","offsetLeft","offsetTop","clientWidth","clientHeight","clientLeft","clientTop"],wo={childNodeCount:function(t){return t.childNodes.length},hasChildNodes:function(t){return!!wo.childNodeCount(t)},childElementCount:function(t){var e=t.children;if(e)return e.length;for(var n=0,r=t.childNodes.length,i=0;i<r;i++)1===t.childNodes[i].nodeType&&n++;return n},hasChildElements:function(t){return!!wo.childElementCount(t)}},yo=(_o.prototype._initializeProperties=function(t,e,n){for(var r=0,i=e;r<i.length;r++){var o=i[r],s=n[o];this[o]=s?s(t):t[o]}},_o);function _o(){}var Eo,Co=(s(So,Eo=yo),So);function So(t){var e=Eo.call(this)||this;return e._initializeProperties(t,po,wo),e}var Io,To={tagName:function(t){return t.tagName.toLowerCase()},visible:function(t){return dr.isElementVisible(t)},focused:function(t){return dr.getActiveElement()===t},attributes:function(t){for(var e=t.attributes,n={},r=e.length-1;0<=r;r--)n[e[r].name]=e[r].value;return n},boundingClientRect:function(t){var e=t.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}},classNames:function(t){var e=t.className;return"string"==typeof e.animVal&&(e=e.animVal),e.replace(/^\s+|\s+$/g,"").split(/\s+/g)},style:function(t){for(var e={},n=Ac.getComputedStyle(t),r=0;r<n.length;r++){var i=n[r];e[i]=n[i]}return e},innerText:function(t){return t.innerText}},bo=(s(xo,Io=yo),xo);function xo(t){var e=Io.call(this)||this;return e._initializeProperties(t,go,To),e}var Wo,Mo=(s(Ao,Wo=Co),Ao);function Ao(t){var e=Wo.call(this,t)||this;return e._initializeProperties(t,vo,To),e}var Po=(Do.prototype._extend=function(t,e){for(var n=0,r=dr.nativeMethods.objectKeys(this._customDOMProperties);n<r.length;n++){var i=r[n];try{t[i]=this._customDOMProperties[i](e)}catch(t){throw new Bt(this._instantiationCallsiteName,t,i)}}},Do.prototype.shouldTransform=function(t,e){return e instanceof dr.nativeMethods.Node},Do.prototype.toSerializable=function(t){var e=new(1===t.nodeType?Mo:Co)(t);return this._extend(e,t),e},Do.prototype.fromSerializable=function(){},Do);function Do(t,e){void 0===t&&(t={}),this.type="Node",this._customDOMProperties=t,this._instantiationCallsiteName=e}var Ro=(No.prototype.shouldTransform=function(t,e){return e instanceof dr.nativeMethods.Node},No.prototype.toSerializable=function(t){return new bo(t)},No.prototype.fromSerializable=function(){},No);function No(){this.type="Node"}var ko=o.Promise,Fo=o.nativeMethods,Lo=(Uo.prototype._onScriptElementAdded=function(t){var e,n,r=this,i=Fo.scriptSrcGetter.call(t);void 0!==i&&""!==i&&(this.scriptsCount++,e=null,n=function(){Fo.removeEventListener.call(t,"load",n),Fo.removeEventListener.call(t,"error",n),Fo.clearTimeout.call(Ac,e),r._onScriptLoadedOrFailed()},Fo.addEventListener.call(t,"load",n),Fo.addEventListener.call(t,"error",n),e=Fo.setTimeout.call(Ac,n,this.SCRIPT_LOADING_TIMEOUT))},Uo.prototype._onScriptLoadedOrFailed=function(){var t=this;this.scriptsCount--,this.scriptsCount||y.delay(25).then(function(){t.resolveWaitingPromise&&(t.scriptsCount||t.resolveWaitingPromise())})},Uo.prototype.wait=function(){var n=this;return new ko(function(t){function e(){Fo.clearTimeout.call(Ac,n.watchdog),o.off(o.EVENTS.scriptElementAdded,n.scriptElementAddedHandler),n.watchdog=null,n.resolveWaitingPromise=null,t()}n.scriptsCount?(n.watchdog=Fo.setTimeout.call(Ac,e,n.BARRIER_TIMEOUT),n.resolveWaitingPromise=e):e()})},Uo);function Uo(){var e=this;this.watchdog=null,this.SCRIPT_LOADING_TIMEOUT=2e3,this.BARRIER_TIMEOUT=3e3,this.scriptsCount=0,this.resolveWaitingPromise=null,this.scriptElementAddedHandler=function(t){return e._onScriptElementAdded(t.el)},o.on(o.EVENTS.scriptElementAdded,this.scriptElementAddedHandler)}function Oo(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=new y.RequestBarrier,i=new Lo;y.pageUnloadBarrier.watchForPageNavigationTriggers();var o=null,s=t.apply(void 0,e),a=s.then(function(t){return o=t,l.Promise.all([r.wait().then(function(){return i.wait()}),y.pageUnloadBarrier.wait()])}).then(function(){return o});return{actionPromise:s,barriersPromise:a}}var Bo,Ho=(s(Go,Bo=Ir),Go.prototype._createReplicator=function(){return cr([new _r])},Go.prototype._getTimeoutErrorParams=function(){return{apiFnIndex:wr.error,apiFnChain:this.command.apiFnChain}},Go.prototype._getTimeoutError=function(t){return t?this.createIsInvisibleError:this.createNotFoundError},Go.prototype._validateElement=function(s,a){var l=this;return dr.PromiseCtor.resolve().then(function(){return Bo.prototype._executeFn.call(l,s)}).then(function(t){var e=t,n=!!e,r=!l.command.visibilityCheck||e&&hr(e),i=dr.nativeMethods.dateNow()-a>=l.timeout;if(n&&(r||dr.isShadowRoot(e)))return e;if(!i)return dr.delay(200).then(function(){return l._validateElement(s,a)});var o=l.getVisibleValueMode?null:l._getTimeoutError(n);if(o)throw o(l._getTimeoutErrorParams());return null})},Go.prototype._executeFn=function(t){return this.counterMode?Bo.prototype._executeFn.call(this,t):this._validateElement(t,dr.nativeMethods.dateNow())},Go);function Go(t,e,n,r,i){var o,s=Bo.call(this,t)||this;s.createNotFoundError=r,s.createIsInvisibleError=i,s.timeout="number"==typeof t.timeout?t.timeout:e,s.counterMode=s.dependencies.filterOptions.counterMode,s.getVisibleValueMode=s.dependencies.filterOptions.getVisibleValueMode,s.dependencies.selectorFilter=wr,n&&(o=dr.nativeMethods.dateNow()-n,s.timeout=Math.max(s.timeout-o,0));var a=s.dependencies.customDOMProperties;return s.replicator.addTransforms([new Po(a,t.instantiationCallsiteName)]),s}var Vo=l.nativeMethods.date,Xo=(Yo.prototype._ensureElement=function(t){var e=this,n=t.selector,r=t.createNotFoundError,i=t.createIsInvisibleError,o=t.createHasWrongNodeTypeError;this.ensureElementsPromise=this.ensureElementsPromise.then(function(){return new Ho(n,e.globalSelectorTimeout,e.ensureElementsStartTime,r,i).getResult()}).then(function(t){if(!y.domUtils.isDomElement(t))throw o(y.NODE_TYPE_DESCRIPTIONS[t.nodeType]);e.elements.push(t)})},Yo.prototype.getElements=function(){var t=this;return this.ensureElementsPromise.then(function(){return t.elements})},Yo);function Yo(t,e){var n=this;this.elements=[],this.globalSelectorTimeout=e,this.ensureElementsPromise=l.Promise.resolve(),this.ensureElementsStartTime=new Vo,t.forEach(function(t){return n._ensureElement(t)})}function zo(t,e){return new Xo(t,e).getElements()}function jo(t){return{selector:t,createNotFoundError:function(t){return new ae(t)},createIsInvisibleError:function(){return new ue},createHasWrongNodeTypeError:function(t){return new fe(t)}}}function qo(t,e){return{selector:t,createNotFoundError:function(t){return new ge(e,t)},createIsInvisibleError:function(){return new ye(e)},createHasWrongNodeTypeError:function(t){return new Ce(e,t)}}}var Ko=o.utils.browser;function Jo(t,e,n){var r=Ko.isFirefox?Math.ceil:Math.round,i=y.positionUtils.getOffsetPosition(t,r);return{x:(t===Pc.documentElement?0:i.left)+e,y:(t===Pc.documentElement?0:i.top)+n}}function $o(t){if(!t)return null;var e=Ac.screenLeft||Ac.screenX,n=Ac.screenTop||Ac.screenY;return{x:e+t.x,y:n+t.y}}function Qo(t){var e=t/2;return e<1?0:Math.round(e)}function Zo(t,e,n){var r,i,o=(r=t,{offsetX:Qo((i=y.positionUtils.getElementRectangle(r)).width),offsetY:Qo(i.height)});if(e="number"==typeof e?Math.round(e):o.offsetX,n="number"==typeof n?Math.round(n):o.offsetY,0<e&&0<n)return{offsetX:e,offsetY:n};var s=y.positionUtils.getClientDimensions(t),a=Math.round(Math.max(t.scrollWidth,s.width)),l=Math.round(Math.max(t.scrollHeight,s.height)),c=s.scrollbar.right+s.border.left+s.border.right+a,u=s.scrollbar.bottom+s.border.top+s.border.bottom+l;return{offsetX:e<0?c+e:e,offsetY:n<0?u+n:n}}function ts(t){return t.top!==t}var es=t.domUtils,ns=ts(Ac)?i.iframeCursorUI:i.cursorUI,rs={x:-1,y:-1,currentActiveWindow:Ac.top,_ensureActiveWindow:function(){var t;this.currentActiveWindow!==Ac&&this.currentActiveWindow!==Ac.parent&&((t=es.findIframeByWindow(this.currentActiveWindow))&&es.isElementInDocument(t)||(this.currentActiveWindow=Ac))},get active(){return this._ensureActiveWindow(),this.currentActiveWindow===Ac},set activeWindow(t){this.currentActiveWindow=t},get activeWindow(){return this._ensureActiveWindow(),this.currentActiveWindow},get position(){return{x:this.x,y:this.y}},get visible(){return!ts(Ac)&&ns.isVisible()},move:function(t,e){return this.x=t,this.y=e,ns.move(this.x,this.y)},hide:function(){this.visible&&ns.hide()},show:function(){ts(Ac)||ns.show()},leftButtonDown:function(){return ns.leftButtonDown()},rightButtonDown:function(){return ns.rightButtonDown()},buttonUp:function(){return ns.buttonUp()}},is=o.utils.browser,os=o.Promise,ss=o.nativeMethods,as=t.positionUtils,ls=t.domUtils;function cs(t,e,n){var r=null;return i.hide(n).then(function(){return r=as.getElementFromPoint(t,e),i.show(n)}).then(function(){return r})}function us(t,e,n){var r=as.getElementFromPoint(t,e),i=ls.containsElement(n,r)&&ss.nodeTextContentGetter.call(r).length;return r&&r===n||i?r:null}function ds(t,e){if(!e||!ls.isDomElement(e)||!t||t===e)return t;if("tref"===ls.getTagName(e))return e;var n,r,i,o="area"===ls.getTagName(e)&&ls.isImgElement(t);if(is.isFirefox&&o)return n=t,r=e,(i=ls.closest(r,"map"))&&i.name===n.useMap.substring(1)?r:n;var s=ls.isAnchorElement(e)||ls.getParents(e,"a").length,a=s&&ls.containsElement(e,t)&&ss.nodeTextContentGetter.call(t).length;if(!s||a||!ss.nodeTextContentGetter.call(e).length)return t;var l=e.getBoundingClientRect();return us(l.right-1,l.top+1,e)||us(l.left+1,l.bottom-1,e)||t}function hs(n,r,i){var o=null;return cs(n,r).then(function(t){o=t;var e=os.resolve(t);return!o&&ts(Ac)&&0<n&&0<r&&(e=e.then(function(){return cs(n,r,!0)}).then(function(t){return o=t})),e.then(function(t){return ds(t,i)}).then(function(t){return{element:t,corrected:t!==o}})})}function fs(){var t=rs.position;return hs(t.x,t.y).then(function(t){return t.element})}var ms="elementIsInvisibleError",ps="foundElementIsNotTarget",gs=(Object.defineProperty(vs.prototype,"mouseActionStepDelay",{get:function(){return 1===this.speedFactor?10:400*(1-this.speedFactor)},enumerable:!1,configurable:!0}),Object.defineProperty(vs.prototype,"keyActionStepDelay",{get:function(){return 1===this.speedFactor?10:200*(1-this.speedFactor)},enumerable:!1,configurable:!0}),Object.defineProperty(vs.prototype,"cursorSpeed",{get:function(){return Math.pow(400,this.speedFactor)/4},enumerable:!1,configurable:!0}),Object.defineProperty(vs.prototype,"draggingSpeed",{get:function(){return Math.pow(16,this.speedFactor)/4},enumerable:!1,configurable:!0}),vs);function vs(t){this.speedFactor=t||1}var ws=o.Promise,ys=o.eventSandbox.message,_s="automation|scroll|request",Es="automation|scroll|response";ys.on(ys.SERVICE_MSG_RECEIVED_EVENT,function(t){var e,n,r,i,o,s;t.message.cmd===_s&&(n=(e=t.message).offsetX,r=e.offsetY,i=e.maxScrollMargin,o=y.domUtils.findIframeByWindow(t.source),(s=new Cs(o,{offsetX:n,offsetY:r})).maxScrollMargin=i,s.run().then(function(){return ys.sendServiceMsg({cmd:Es},t.source)}))});var Cs=(Ss.prototype._isScrollValuesChanged=function(t,e){return y.styleUtils.getScrollLeft(t)!==e.left||y.styleUtils.getScrollTop(t)!==e.top},Ss.prototype._setScroll=function(t,e){var n=this,r=e.left,i=e.top,o=y.domUtils.isHtmlElement(t)?y.domUtils.findDocument(t):t,s={left:y.styleUtils.getScrollLeft(o),top:y.styleUtils.getScrollTop(o)},r=Math.max(r,0),i=Math.max(i,0),a=y.scrollController.waitForScroll(o);return y.styleUtils.setScrollLeft(o,r),y.styleUtils.setScrollTop(o,i),this._isScrollValuesChanged(o,s)?a=a.then(function(){n.scrollWasPerformed=n.scrollWasPerformed||n._isScrollValuesChanged(o,s)}):(a.cancel(),ws.resolve())},Ss.prototype._getScrollToPoint=function(t,e,n){var r=e.x,i=e.y,o=Math.floor(t.width/2),s=Math.floor(Math.floor(t.height/2)),a=this.scrollToCenter?o:Math.min(n.left,o),l=this.scrollToCenter?s:Math.min(n.top,s),c=r>=t.scroll.left+t.width-a,u=r<=t.scroll.left+a,d=i>=t.scroll.top+t.height-l,h=i<=t.scroll.top+l,f=t.scroll.left,m=t.scroll.top;return c?f=r-t.width+a:u&&(f=r-a),d?m=i-t.height+l:h&&(m=i-l),{left:f,top:m}},Ss.prototype._getScrollToFullChildView=function(t,e,n){var r,i,o,s,a=null,l=null,c=t.width>=e.width,u=t.height>=e.height,d=y.positionUtils.calcRelativePosition(e,t);return c&&(r=t.width-e.width,i=Math.min(n.left,r),this.scrollToCenter&&(i=r/2),d.left<i?a=Math.round(t.scroll.left+d.left-i):d.right<i&&(a=Math.round(t.scroll.left+Math.min(d.left,-d.right)+i))),u&&(o=t.height-e.height,s=Math.min(n.top,o),this.scrollToCenter&&(s=o/2),d.top<s?l=Math.round(t.scroll.top+d.top-s):d.bottom<s&&(l=Math.round(t.scroll.top+Math.min(d.top,-d.bottom)+s))),{left:a,top:l}},Ss._getChildPoint=function(t,e,n){return{x:e.left-t.left+t.scroll.left+e.border.left+n.x,y:e.top-t.top+t.scroll.top+e.border.top+n.y}},Ss.prototype._getScrollPosition=function(t,e,n,r){var i=Ss._getChildPoint(t,e,n),o=this._getScrollToPoint(t,i,r),s=this._getScrollToFullChildView(t,e,r);return{left:Math.max(null===s.left?o.left:s.left,0),top:Math.max(null===s.top?o.top:s.top,0)}},Ss._getChildPointAfterScroll=function(t,e,n,r){return{x:Math.round(e.left+t.scroll.left-n.left+r.x),y:Math.round(e.top+t.scroll.top-n.top+r.y)}},Ss.prototype._isChildFullyVisible=function(t,e,n){var r=Ss._getChildPointAfterScroll(t,e,t.scroll,n),i=r.x,o=r.y,s=this._getScrollPosition(t,e,n,{left:0,top:0}),a=s.left,l=s.top;return!this._isTargetElementObscuredInPoint(i,o)&&a===t.scroll.left&&l===t.scroll.top},Ss.prototype._scrollToChild=function(t,e,n){for(var r=y.positionUtils.getClientDimensions(t),i=y.positionUtils.getClientDimensions(e),o=y.styleUtils.getInnerWidth(Ac),s=y.styleUtils.getInnerHeight(Ac),a=r.scroll,l=!this._isChildFullyVisible(r,i,n);l;){a=this._getScrollPosition(r,i,n,this.maxScrollMargin);var c=Ss._getChildPointAfterScroll(r,i,a,n),u=c.x,d=c.y,h=this._isTargetElementObscuredInPoint(u,d);this.maxScrollMargin.left+=20,this.maxScrollMargin.left>=o&&(this.maxScrollMargin.left=50,this.maxScrollMargin.top+=20),l=h&&this.maxScrollMargin.top<s}return this.maxScrollMargin={left:50,top:50},this._setScroll(t,a)},Ss.prototype._scrollElement=function(){if(!y.styleUtils.hasScroll(this.element))return ws.resolve();var t=y.positionUtils.getClientDimensions(this.element),e=this._getScrollToPoint(t,{x:this.offsetX,y:this.offsetY},this.maxScrollMargin);return this._setScroll(this.element,e)},Ss.prototype._scrollParents=function(){var e,n,r=this,i=y.styleUtils.getScrollableParents(this.element),o=this.element,s=this.offsetX-Math.round(y.styleUtils.getScrollLeft(o)),a=this.offsetY-Math.round(y.styleUtils.getScrollTop(o));return y.promiseUtils.times(i.length,function(t){return r._scrollToChild(i[t],o,{x:s,y:a}).then(function(){e=y.positionUtils.getClientDimensions(o),n=y.positionUtils.getClientDimensions(i[t]),s+=e.left-n.left+n.border.left,a+=e.top-n.top+n.border.top,o=i[t]})}).then(function(){return ts(Ac)&&!r.skipParentFrames?y.sendRequestToFrame({cmd:_s,offsetX:s,offsetY:a,maxScrollMargin:r.maxScrollMargin},Es,Ac.parent):ws.resolve()})},Ss._getFixedAncestorOrSelf=function(t){return y.domUtils.findParent(t,!0,y.styleUtils.isFixedElement)},Ss.prototype._isTargetElementObscuredInPoint=function(t,e){var n=y.positionUtils.getElementFromPoint(t,e);if(!n)return!1;var r=Ss._getFixedAncestorOrSelf(n);return r&&!r.contains(this.element)},Ss.prototype.run=function(){var t=this;return this._scrollElement().then(function(){return t._scrollParents()}).then(function(){return t.scrollWasPerformed})},Ss);function Ss(t,e){this.element=t,this.offsetX=e.offsetX,this.offsetY=e.offsetY,this.scrollToCenter=e.scrollToCenter,this.skipParentFrames=e.skipParentFrames,this.raiseEvents=e.raiseEvents,this.maxScrollMargin={left:50,top:50},this.scrollWasPerformed=!1}function Is(r){return function(t,e){var n=typeof e;if("number"!=n)throw new r(t,n);if(isNaN(e)||!isFinite(e)||e!==Math.floor(e))throw new r(t,e)}}var Ts,bs,xs,Ws,Ms,As=Is(Kt),Ps=(bs=Is(Ts=Qt),function(t,e){if(bs(t,e),e<0)throw new Ts(t,e)}),Ds=(xs=ee,function(t,e){var n=typeof e;if("boolean"!=n)throw new xs(t,n)}),Rs=(Ws=ie,function(t,e){var n=typeof e;if("number"!=n)throw new Ws(t,n);if(isNaN(e)||e<.01||1<e)throw new Ws(t,e)}),Ns=(s(ks,Ms=io),ks.prototype._getAssignableProperties=function(){return[{name:"speed",type:Rs}]},ks);function ks(t,e){var n=Ms.call(this)||this;return n.speed=null,n._assignFrom(t,e),n}var Fs,Ls=(s(Us,Fs=Ns),Us.prototype._getAssignableProperties=function(){return Fs.prototype._getAssignableProperties.call(this).concat([{name:"offsetX",type:As},{name:"offsetY",type:As}])},Us);function Us(t,e){var n=Fs.call(this)||this;return n.offsetX=null,n.offsetY=null,n._assignFrom(t,e),n}var Os,Bs=(s(Hs,Os=Ls),Hs.prototype._getAssignableProperties=function(){return Os.prototype._getAssignableProperties.call(this).concat([{name:"scrollToCenter",type:Ds},{name:"skipParentFrames",type:Ds}])},Hs);function Hs(t,e){var n=Os.call(this)||this;return n.scrollToCenter=!1,n.skipParentFrames=!1,n._assignFrom(t,e),n}var Gs,Vs=(s(Xs,Gs=Ns),Xs.prototype._getAssignableProperties=function(){return Gs.prototype._getAssignableProperties.call(this).concat([{name:"scrollTargetX",type:As},{name:"scrollTargetY",type:As},{name:"crop.left",type:As},{name:"crop.right",type:As},{name:"crop.top",type:As},{name:"crop.bottom",type:As},{name:"includeMargins",type:Ds},{name:"includeBorders",type:Ds},{name:"includePaddings",type:Ds}])},Xs);function Xs(t,e){var n=Gs.call(this)||this;return n.scrollTargetX=null,n.scrollTargetY=null,n.includeMargins=!1,n.includeBorders=!0,n.includePaddings=!0,n.crop={left:null,right:null,top:null,bottom:null},n._assignFrom(t,e),n}var Ys,zs=(s(js,Ys=Ls),js.prototype._getAssignableProperties=function(){return Ys.prototype._getAssignableProperties.call(this).concat([{name:"modifiers.ctrl",type:Ds},{name:"modifiers.alt",type:Ds},{name:"modifiers.shift",type:Ds},{name:"modifiers.meta",type:Ds}])},js);function js(t,e){var n=Ys.call(this)||this;return n.modifiers={ctrl:!1,alt:!1,shift:!1,meta:!1},n._assignFrom(t,e),n}var qs,Ks=(s(Js,qs=zs),Js.prototype._getAssignableProperties=function(){return qs.prototype._getAssignableProperties.call(this).concat([{name:"caretPos",type:Ps}])},Js);function Js(t,e){var n=qs.call(this)||this;return n.caretPos=null,n._assignFrom(t,e),n}var $s,Qs,Zs,ta,ea,na,ra=(s(ia,$s=zs),ia.prototype._getAssignableProperties=function(){return $s.prototype._getAssignableProperties.call(this).concat([{name:"speed"},{name:"minMovingTime"},{name:"holdLeftButton"},{name:"skipScrolling",type:Ds},{name:"skipDefaultDragBehavior",type:Ds}])},ia);function ia(t,e){var n=$s.call(this)||this;return n.speed=null,n.minMovingTime=null,n.holdLeftButton=!1,n.skipScrolling=!1,n.skipDefaultDragBehavior=!1,n._assignFrom(t,e),n}function oa(t,e){var n=Qs.call(this)||this;return n.replace=!1,n.paste=!1,n.confidential=void 0,n._assignFrom(t,e),n}function sa(t,e){var n=Zs.call(this,t,e)||this;return n.destinationOffsetX=null,n.destinationOffsetY=null,n._assignFrom(t,e),n}function aa(t,e){var n=ta.call(this)||this;return n.portraitOrientation=!1,n._assignFrom(t,e),n}function la(t,e){var n=ea.call(this)||this;return n.timeout=void 0,n.allowUnawaitedPromise=!1,n._assignFrom(t,e),n}function ca(t,e){var n=na.call(this)||this;return n.confidential=void 0,n._assignFrom(t,e),n}function ua(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function da(t,e,n){for(var r,i=[],o=[{x1:n.left,y1:n.top,x2:n.left,y2:n.bottom,isHorizontal:!1},{x1:n.right,y1:n.top,x2:n.right,y2:n.bottom,isHorizontal:!1},{x1:n.left,y1:n.top,x2:n.right,y2:n.top,isHorizontal:!0},{x1:n.left,y1:n.bottom,x2:n.right,y2:n.bottom,isHorizontal:!0}],s=0;s<o.length;s++)(r=function(t,e,n){var r;if(n.isHorizontal)return(r=y.positionUtils.getLineXByYCoord(t,e,n.y1))&&r>=n.x1&&r<=n.x2?{x:r,y:n.y1}:null;var i=y.positionUtils.getLineYByXCoord(t,e,n.x1);return i&&i>=n.y1&&i<=n.y2?{x:n.x1,y:i}:null}(t,e,o[s]))&&i.push(r);return i.length?1===i.length||ua(t,i[0])<ua(t,i[1])?i[0]:i[1]:null}s(oa,Qs=Ks),oa.prototype._getAssignableProperties=function(){return Qs.prototype._getAssignableProperties.call(this).concat([{name:"replace",type:Ds},{name:"paste",type:Ds},{name:"confidential",type:Ds}])},s(sa,Zs=zs),sa.prototype._getAssignableProperties=function(){return Zs.prototype._getAssignableProperties.call(this).concat([{name:"destinationOffsetX",type:As},{name:"destinationOffsetY",type:As}])},s(aa,ta=io),aa.prototype._getAssignableProperties=function(){return[{name:"portraitOrientation",type:Ds}]},s(la,ea=io),la.prototype._getAssignableProperties=function(){return[{name:"timeout",type:Ps},{name:"allowUnawaitedPromise",type:Ds}]},s(ca,na=Ns),ca.prototype._getAssignableProperties=function(){return na.prototype._getAssignableProperties.call(this).concat([{name:"confidential",type:Ds}])};var ha=o.Promise,fa=o.nativeMethods;function ma(){return new ha(function(t){return fa.setTimeout.call(Ac,t,0)})}var pa=function(){this.enabled=!1,this.dropAllowed=!1,this.element=null,this.dataTransfer=null,this.dataStore=null},ga=o.utils.browser,va=(wa.prototype.setup=function(){this.dragAndDropMode=!1,this.dropAllowed=!1},wa.prototype.leaveElement=function(){},wa.prototype.move=function(){},wa.prototype.enterElement=function(){},wa.prototype.dragAndDrop=function(){},wa.prototype.teardown=function(){},wa.prototype.run=function(t,e,n,r,i){var o=e&&y.domUtils.isElementInDocument(e),s=e&&y.domUtils.isElementInIframe(e)&&!y.domUtils.getIframeByElement(e);o&&!s||(e=null);var a=t!==e,l=a?y.domUtils.getCommonAncestor(t,e):null;this.setup(),a&&e&&this.leaveElement(t,e,l,n),ga.isIE&&this.move(t,n),a&&y.domUtils.isElementInDocument(t)&&this.enterElement(t,e,l,n),ga.isIE||this.move(t,n),this.dragAndDrop(r,t,e,n,i),this.teardown(t,n,e);var c=this.dragAndDropMode,u=this.dropAllowed;return this.dragAndDropMode=!1,this.dropAllowed=!1,{dragAndDropMode:c,dropAllowed:u}},wa);function wa(t){var e=t.moveEvent;this.dragAndDropMode=!1,this.dropAllowed=!1,this.moveEvent=e}var ya=o.eventSandbox.eventSimulator,_a=o.utils.extend,Ea=o.nativeMethods,Ca=(Sa.leaveElement=function(t,e,n,r){ya.mouseout(e,_a({relatedTarget:t},r));for(var i=e;i&&i!==n;)ya.mouseleave(i,_a({relatedTarget:t},r)),i=Ea.nodeParentNodeGetter.call(i)},Sa.enterElement=function(t,e,n,r){ya.mouseover(t,_a({relatedTarget:e},r));for(var i=t,o=[];i&&i!==n;)o.push(i),i=y.domUtils.getParentExceptShadowRoot(i);for(var s=o.length-1;-1<s;s--)ya.mouseenter(o[s],_a({relatedTarget:e},r))},Sa.move=function(t,e,n){ya[t](e,n)},Sa);function Sa(){}var Ia=(Ta.dragAndDrop=function(t,e,n,r){return ya.drag(t,r),e!==n&&(y.domUtils.isElementInDocument(e)&&(r.relatedTarget=n,ya.dragenter(e,r)),n&&(r.relatedTarget=e,ya.dragleave(n,r))),!ya.dragover(e,r)},Ta);function Ta(){}var ba,xa=o.eventSandbox.eventSimulator,Wa=(s(Ma,ba=va),Ma.prototype.leaveElement=function(t,e,n,r){Ca.leaveElement(t,e,n,r)},Ma.prototype.enterElement=function(t,e,n,r){Ca.enterElement(t,e,n,r)},Ma.prototype.move=function(t,e){this._needEmulateMoveEvent()&&Ca.move(this.moveEvent,t,e)},Ma.prototype.teardown=function(t,e,n){this._needEmulateMoveEvent()&&y.domUtils.isElementInDocument(t)&&t!==n&&xa[this.moveEvent](t,e)},Ma.prototype._needEmulateMoveEvent=function(){return"touchmove"!==this.moveEvent||this.holdLeftButton},Ma);function Ma(t){var e=ba.call(this,t)||this;return e.holdLeftButton=t.holdLeftButton,e}var Aa,Pa=(s(Da,Aa=va),Da.prototype.setup=function(){Aa.prototype.setup.call(this),this.dragAndDropMode=!0},Da.prototype.dragAndDrop=function(t,e,n,r){this.dropAllowed=Ia.dragAndDrop(t,e,n,r)},Da);function Da(){return null!==Aa&&Aa.apply(this,arguments)||this}var Ra,Na=o.eventSandbox.eventSimulator,ka=(s(Fa,Ra=va),Fa.prototype.setup=function(){Ra.prototype.setup.call(this),this.dragAndDropMode=!0},Fa.prototype.leaveElement=function(t,e,n,r){Ca.leaveElement(t,e,n,r)},Fa.prototype.move=function(t,e){Ca.move(this.moveEvent,t,e)},Fa.prototype.enterElement=function(t,e,n,r){Ca.enterElement(t,e,n,r)},Fa.prototype.dragAndDrop=function(t,e,n,r,i){var o=Na.dragstart(t,r);i.setReadOnlyMode(),o?this.dropAllowed=Ia.dragAndDrop(t,e,n,r):this.dragAndDropMode=!1},Fa.prototype.run=function(t,e,n,r,i){return Ra.prototype.run.call(this,t,null,n,r,i)},Fa);function Fa(){return null!==Ra&&Ra.apply(this,arguments)||this}var La=null,Ua=function(){return La},Oa=function(t){La=t},Ba=o.Promise,Ha=o.nativeMethods,Ga=o.utils.featureDetection,Va=o.utils.html,Xa=o.utils.url,Ya=o.eventSandbox.eventSimulator,za=o.eventSandbox.message,ja=o.eventSandbox.DataTransfer,qa=o.eventSandbox.DragDataStore,Ka=t.positionUtils,Ja=t.domUtils,$a=t.styleUtils,Qa=t.eventUtils,Za=t.promiseUtils,tl=t.sendRequestToFrame,el="automation|move|request",nl="automation|move|response";za.on(za.SERVICE_MSG_RECEIVED_EVENT,function(t){t.message.cmd===el&&(t.source.parent===Ac?rl.onMoveToIframeRequest(t):(o.on(o.EVENTS.beforeUnload,function(){return za.sendServiceMsg({cmd:nl},t.source)}),rl.onMoveOutRequest(t)))});var rl=(il.getTarget=function(t,e,n){var r=!Ka.containsOffset(t,e,n),i=r?Jo(t,e,n):{x:e,y:n};return{element:r?Pc.documentElement:t,offsetX:i.x,offsetY:i.y}},il.onMoveToIframeRequest=function(t){var e={x:t.message.endX,y:t.message.endY},n=t.source,r=Ja.findIframeByWindow(n),i=$a.getBordersWidth(r),o=$a.getElementPadding(r),s=Ka.getIframeClientCoordinates(r),a=Ka.getIframePointRelativeToParentFrame(e,n),l=rs.position,c=Ka.isInRectangle(l,s)?l:da(l,a,s),u={x:c.x-s.left,y:c.y-s.top},d=new il(r,new ra({modifiers:t.message.modifiers,offsetX:u.x+i.left+o.left,offsetY:u.y+i.top+o.top,speed:t.message.speed,skipScrolling:!0},!1)),h={cmd:nl,x:u.x,y:u.y};rs.activeWindow!==n?d.run().then(function(){rs.activeWindow=n,za.sendServiceMsg(h,n)}):za.sendServiceMsg(h,n)},il.onMoveOutRequest=function(t){var e=t.source,n={left:t.message.left,right:t.message.right,top:t.message.top,bottom:t.message.bottom};if(!t.message.iframeUnderCursor){var r=t.message,i=r.startX,o=r.startY,s=i-n.left,a=o-n.top,l=Ua();return l&&(Ya.mouseout(l,{clientX:s,clientY:a,relatedTarget:null}),Ya.mouseleave(l,{clientX:s,clientY:a,relatedTarget:null})),void za.sendServiceMsg({cmd:nl},e)}var c,u=rs.position,d=da({x:n.left+u.x,y:n.top+u.y},{x:t.message.endX,y:t.message.endY},n);d?(c=new ra({modifiers:t.message.modifiers,offsetX:d.x-n.left,offsetY:d.y-n.top,speed:t.message.speed,skipScrolling:!0},!1),new il(Pc.documentElement,c).run().then(function(){var t={cmd:nl,x:d.x,y:d.y};rs.activeWindow=e,za.sendServiceMsg(t,e)})):za.sendServiceMsg({cmd:nl,x:n.left,y:n.top},e)},il.prototype._getTargetClientPoint=function(){var t=$a.getElementScroll(this.element);if(Ja.isHtmlElement(this.element))return{x:Math.floor(this.offsetX-t.left),y:Math.floor(this.offsetY-t.top)};var e=Ka.getClientPosition(this.element),n=this.element.tagName&&Ja.isBodyElement(this.element);return{x:Math.floor(n?e.x+this.offsetX:e.x+this.offsetX-t.left),y:Math.floor(n?e.y+this.offsetY:e.y+this.offsetY-t.top)}},il.prototype._emulateEvents=function(t){var e,n,r=this.holdLeftButton?Qa.BUTTONS_PARAMETER.leftButton:Qa.BUTTONS_PARAMETER.noButton,i=$o({x:this.x,y:this.y}),o={clientX:this.x,clientY:this.y,screenX:i.x,screenY:i.y,buttons:r,ctrl:this.modifiers.ctrl,alt:this.modifiers.alt,shift:this.modifiers.shift,meta:this.modifiers.meta,dataTransfer:this.dragAndDropState.dataTransfer},s={moveEvent:this.moveEvent,holdLeftButton:this.holdLeftButton},a=(e=this.dragAndDropState.enabled,n=this.firstMovingStepOccured,new(e?n?Pa:ka:Wa)(s).run(t,Ua(),o,this.dragElement,this.dragAndDropState.dataStore)),l=a.dragAndDropMode,c=a.dropAllowed;this.firstMovingStepOccured=!0,this.dragAndDropState.enabled=l,this.dragAndDropState.dropAllowed=c,Oa(t)},il.prototype._movingStep=function(){var t,n=this;return this.touchMode&&!this.holdLeftButton?(this.x=this.endPoint.x,this.y=this.endPoint.y):this.startTime?(t=(Math.min(Ha.dateNow(),this.endTime)-this.startTime)/(this.endTime-this.startTime),this.x=Math.floor(this.startPoint.x+this.distanceX*t),this.y=Math.floor(this.startPoint.y+this.distanceY*t)):(this.startTime=Ha.dateNow(),this.endTime=this.startTime+this.movingTime,this.x+=0<this.distanceX?1:-1,this.y+=0<this.distanceY?1:-1),rs.move(this.x,this.y).then(fs).then(function(t){var e=n.holdLeftButton&&n.touchMode?n.dragElement:t;return e?n._emulateEvents(e):null}).then(ma)},il.prototype._isMovingFinished=function(){return this.x===this.endPoint.x&&this.y===this.endPoint.y},il.prototype._move=function(){var t=this;return this.startPoint=rs.position,this.x=this.startPoint.x,this.y=this.startPoint.y,this.distanceX=this.endPoint.x-this.startPoint.x,this.distanceY=this.endPoint.y-this.startPoint.y,this.movingTime=Math.max(Math.abs(this.distanceX),Math.abs(this.distanceY))/this.cursorSpeed,this.minMovingTime&&(this.movingTime=Math.max(this.movingTime,this.minMovingTime)),Za.whilst(function(){return!t._isMovingFinished()},function(){return t._movingStep()})},il.prototype._scroll=function(){if(this.skipScrolling)return Ba.resolve();var t=new Bs({offsetX:this.offsetX,offsetY:this.offsetY},!1);return new Cs(this.element,t).run()},il.prototype._moveToCurrentFrame=function(){if(rs.active)return Ba.resolve();var t,e=rs.position,n=e.x,r=e.y,i=rs.activeWindow,o=null,s=null,a={cmd:el,startX:n,startY:r,endX:this.endPoint.x,endY:this.endPoint.y,modifiers:this.modifiers,speed:this.speed};return i.parent===Ac&&(o=Ja.findIframeByWindow(i),t=Ka.getIframeClientCoordinates(o),a.left=t.left,a.top=t.top,a.right=t.right,a.bottom=t.bottom),fs().then(function(t){return s=t===o,i.parent===Ac&&(a.iframeUnderCursor=s),tl(a,nl,i)}).then(function(t){return rs.activeWindow=Ac,s||ts(Ac)?rs.move(t.x,t.y):null})},il.prototype.run=function(){var a=this;return fs().then(function(t){a.dragElement=a.holdLeftButton?t:null;var e,n,r,i,o,s=function(t){for(var e=t;e;){if(e.draggable)return e;e=Ha.nodeParentNodeGetter.call(e)}return null}(a.dragElement);return s&&Ga.hasDataTransfer&&!a.skipDefaultDragBehavior&&(a.dragAndDropState.enabled=!0,a.dragElement=s,a.dragAndDropState.element=a.dragElement,a.dragAndDropState.dataStore=new qa,a.dragAndDropState.dataTransfer=new ja(a.dragAndDropState.dataStore),((e=Ja.isAnchorElement(a.dragElement))||Ja.isImgElement(a.dragElement))&&(n=e?"href":"src",i=(r=Xa.parseProxyUrl(a.dragElement[n]))?r.destUrl:a.dragElement[n],o=Va.cleanUpHtml(Ha.elementOuterHTMLGetter.call(a.dragElement)),a.dragAndDropState.dataTransfer.setData("text/plain",i),a.dragAndDropState.dataTransfer.setData("text/uri-list",i),a.dragAndDropState.dataTransfer.setData("text/html",o))),a._scroll()}).then(function(){var t=a._getTargetClientPoint(),e=t.x,n=t.y,r=$a.getWidth(Ac),i=$a.getHeight(Ac);return 0<=e&&e<=r&&0<=n&&n<=i?(a.endPoint={x:e,y:n},a._moveToCurrentFrame().then(function(){return a._move()})):null}).then(function(){return a.dragAndDropState})},il);function il(t,e){this.touchMode=Ga.isTouchDevice,this.moveEvent=this.touchMode?"touchmove":"mousemove",this.holdLeftButton=e.holdLeftButton,this.dragElement=null,this.dragAndDropState=new pa,this.automationSettings=new gs(e.speed);var n=il.getTarget(t,e.offsetX,e.offsetY);this.element=n.element,this.offsetX=n.offsetX,this.offsetY=n.offsetY,this.speed=e.speed,this.cursorSpeed=this.holdLeftButton?this.automationSettings.draggingSpeed:this.automationSettings.cursorSpeed,this.minMovingTime=e.minMovingTime||null,this.modifiers=e.modifiers||{},this.skipScrolling=e.skipScrolling,this.skipDefaultDragBehavior=e.skipDefaultDragBehavior,this.endPoint=null,this.movingTime=null,this.x=null,this.y=null,this.startTime=null,this.endTime=null,this.distanceX=null,this.distanceY=null,this.firstMovingStepOccured=!1}var ol,sl=o.utils.extend,al=function(t){var e=t.element,n=void 0===e?null:e,r=t.clientPoint,i=void 0===r?null:r,o=t.screenPoint,s=void 0===o?null:o,a=t.isTarget,l=void 0!==a&&a,c=t.inMoving,u=void 0!==c&&c;this.element=n,this.clientPoint=i,this.screenPoint=s,this.isTarget=l,this.inMoving=u,this.devicePoint=$o(i)},ll=(s(cl,ol=y.serviceUtils.EventEmitter),cl.prototype._getElementForEvent=function(t){var e=t.point;return hs(e.x,e.y,y.positionUtils.containsOffset(this.element,this.options.offsetX,this.options.offsetY)?this.element:null).then(function(t){return t.element})},cl.prototype._moveToElement=function(){var t=this,e=new ra(sl({skipScrolling:!0},this.options),!1);return new rl(this.element,e).run().then(function(){return y.delay(t.automationSettings.mouseActionStepDelay)})},cl.prototype._scrollToElement=function(){var s=this,t=new Bs(this.options),e=new Cs(this.element,t),a=!1;return e.run().then(function(t){return a=t,y.delay(s.automationSettings.mouseActionStepDelay)}).then(fs).then(function(t){if(!t||!y.domUtils.contains(s.element,t)||!a)return null;var e=Ua(),n=y.domUtils.getCommonAncestor(t,e),r=y.positionUtils.getClientPosition(t),i=$o({x:r.x,y:r.y}),o={clientX:r.x,clientY:r.y,screenX:i.x,screenY:i.y,ctrl:!1,alt:!1,shift:!1,meta:!1,buttons:y.eventUtils.BUTTONS_PARAMETER.leftButton};return Ca.leaveElement(t,e,n,o),Ca.enterElement(t,e,n,o),Oa(t),a})},cl.prototype._getElementOffset=function(){var t=Zo(this.element),e=this.options,n=e.offsetX,r=e.offsetY;return{offsetX:n=n||0===n?n:t.offsetX,offsetY:r=r||0===r?r:t.offsetY}},cl.prototype._wrapAction=function(t){var d=this,e=this._getElementOffset(),r=e.offsetX,i=e.offsetY,h=Jo(this.element,r,i),f=y.positionUtils.getClientPosition(this.element);return t().then(function(){var t,e,n,a=Jo(d.element,r,i),l=y.positionUtils.getClientPosition(d.element),c=(t=d.element,e=a,n=y.styleUtils.getElementScroll(t),!/html/i.test(t.tagName)&&y.styleUtils.hasScroll(t)&&(e.x-=n.left,e.y-=n.top),y.positionUtils.offsetToClientCoords(e)),u=y.positionUtils.containsOffset(d.element,r,i)?d.element:null;return hs(c.x,c.y,u).then(function(t){var e=t.element,n=t.corrected,r=e;if(!r)return new al({});var i=(i=!u||n||r===d.element)||-1<y.arrayUtils.indexOf(y.domUtils.getParents(r),d.element),o=h.x!==a.x||h.y!==a.y,s=f.x!==l.x||f.y!==l.y;return new al({element:e,clientPoint:c,screenPoint:a,isTarget:i,inMoving:o&&s})})})},cl._checkElementState=function(t,e){if(!t.element)throw new Error(ms);if(e&&(!t.isTarget||t.inMoving))throw new Error(ps);return t},cl.prototype._ensureElement=function(e,n,r){var i=this;return this._wrapAction(function(){return i._scrollToElement()}).then(function(t){return cl._checkElementState(t,e)}).then(function(t){return r?t:i._wrapAction(function(){return i._moveToElement()})}).then(function(t){return n||cl._checkElementState(t,e),t}).then(function(t){return i.emit(i.TARGET_ELEMENT_FOUND_EVENT,{element:t.element}),{element:t.element,clientPoint:t.clientPoint,screenPoint:t.screenPoint,devicePoint:t.devicePoint}})},cl);function cl(t,e){var n=ol.call(this)||this;return n.TARGET_ELEMENT_FOUND_EVENT="automation|target-element-found-event",n.element=t,n.options=e,n.automationSettings=new gs(e.speed),n}var ul,dl=o.Promise,hl=(s(fl,ul=ll),fl.prototype.run=function(t){var e=this,n=dl.resolve();return this.element!==Pc.scrollingElement&&this.element!==Pc.documentElement&&(n=this._ensureElement(t,!0,!0)),n.then(function(){e.element.scrollLeft=e.scrollLeft,e.element.scrollTop=e.scrollTop})},fl);function fl(t,e,n){var r,i,o,s,a,l=e.x,c=e.y,u=e.position,d=e.byX,h=e.byY,f=ul.call(this,t,n)||this;return u&&(i=t,o=u,s=Math.floor(i.scrollWidth/2-i.clientWidth/2),a=Math.floor(i.scrollHeight/2-i.clientHeight/2),l=(r={top:[s,0],right:[i.scrollWidth,a],bottom:[s,i.scrollHeight],left:[0,a],topRight:[i.scrollWidth,0],topLeft:[0,0],bottomRight:[i.scrollWidth,i.scrollHeight],bottomLeft:[0,i.scrollHeight],center:[s,a]}[o])[0],c=r[1]),f.scrollLeft="number"==typeof l?l:t.scrollLeft,f.scrollTop="number"==typeof c?c:t.scrollTop,d&&(f.scrollLeft+=d),h&&(f.scrollTop+=h),f}var ml,pl=(s(gl,ml=ll),gl.prototype.run=function(t){return this._ensureElement(t,!0,!0)},gl);function gl(t,e){return ml.call(this,t,e)||this}function vl(t,e){if(!y.domUtils.isContentEditableElement(t))throw new Pe(e)}var wl=l.nativeMethods.date,yl=(_l.prototype._getSpecificTimeout=function(){return this.command.selector&&"number"==typeof this.command.selector.timeout?this.command.selector.timeout:this.globalSelectorTimeout},_l.prototype._delayAfterExecution=function(){return this.command.options&&1!==this.command.options.speed?y.delay(2e3*(1-this.command.options.speed)):l.Promise.resolve()},_l.prototype._isExecutionTimeoutExpired=function(){return l.nativeMethods.dateNow()-this.executionStartTime>=this.commandSelectorTimeout},_l.prototype._ensureCommandArguments=function(){if(this.command.type===m.pressKey&&y.parseKeySequence(this.command.keys).error)throw new Le("keys")},_l.prototype._ensureCommandElements=function(){var e=this,t=[];return this.command.selector&&t.push(jo(this.command.selector)),this.command.type===m.dragToElement?t.push(qo(this.command.destinationSelector,"destinationSelector")):this.command.type===m.selectEditableContent?(t.push(qo(this.command.startSelector,"startSelector")),t.push(qo(this.command.endSelector||this.command.startSelector,"endSelector"))):this.command.type===m.dispatchEvent&&this.command.relatedTarget&&t.push(qo(this.command.relatedTarget,"relatedTarget")),zo(t,this.globalSelectorTimeout).then(function(t){e.elements=t})},_l.prototype._ensureCommandElementsProperties=function(){this.command.type===m.selectText?function(t){if(!y.domUtils.isEditableElement(t))throw new Te}(this.elements[0]):this.command.type===m.selectTextAreaContent?function(t){if(!y.domUtils.isTextAreaElement(t))throw new We}(this.elements[0]):this.command.type===m.selectEditableContent?(vl(this.elements[0],"startSelector"),vl(this.elements[1],"endSelector"),function(t){if(!y.contentEditable.getNearestCommonAncestor(t[0],t[1]))throw new Ne}(this.elements)):this.command.type!==m.setFilesToUpload&&this.command.type!==m.clearUpload||function(t){if(!y.domUtils.isFileInput(t))throw new Ve}(this.elements[0])},_l.prototype._ensureCommandOptions=function(){var t,e,n,r,i;this.elements.length&&this.command.options&&"offsetX"in this.command.options&&"offsetY"in this.command.options&&(t=this.elements[0],e=this.command.options,n=_.getOffsetOptions(t,e.offsetX,e.offsetY),r=n.offsetX,i=n.offsetY,e.offsetX=r,e.offsetY=i)},_l.prototype._createAutomation=function(){var t;switch(this.command.type){case m.dispatchEvent:return this.elements[1]&&(this.command.options.relatedTarget=this.elements[1]),new _.DispatchEvent(this.elements[0],this.command.eventName,this.command.options);case m.click:return/option|optgroup/.test(y.domUtils.getTagName(this.elements[0]))?new _.SelectChildClick(this.elements[0],this.command.options):new _.Click(this.elements[0],this.command.options);case m.rightClick:return new _.RClick(this.elements[0],this.command.options);case m.doubleClick:return new _.DblClick(this.elements[0],this.command.options);case m.hover:return new _.Hover(this.elements[0],this.command.options);case m.drag:return new _.DragToOffset(this.elements[0],this.command.dragOffsetX,this.command.dragOffsetY,this.command.options);case m.dragToElement:return new _.DragToElement(this.elements[0],this.elements[1],this.command.options);case m.scroll:var e=this.command,n=e.x,r=e.y,i=e.position,o=e.options;return new hl(this.elements[0],{x:n,y:r,position:i},o);case m.scrollBy:var s=this.command,a=s.byX,l=s.byY,o=s.options;return new hl(this.elements[0],{byX:a,byY:l},o);case m.scrollIntoView:return new pl(this.elements[0],this.command.options);case m.typeText:return new _.Type(this.elements[0],this.command.text,this.command.options);case m.selectText:case m.selectTextAreaContent:return t=_.calculateSelectTextArguments(this.elements[0],this.command),new _.SelectText(this.elements[0],t.startPos,t.endPos,this.command.options);case m.selectEditableContent:return new _.SelectEditableContent(this.elements[0],this.elements[1],this.command.options);case m.pressKey:return new _.Press(y.parseKeySequence(this.command.keys).combinations,this.command.options);case m.setFilesToUpload:return new _.Upload(this.elements[0],this.command.filePath,function(t,e){return new Be(t,e)});case m.clearUpload:return new _.Upload(this.elements[0])}return null},_l.prototype._runAction=function(e){var n=this;return this._ensureCommandElements().then(function(){return n._ensureCommandElementsProperties()}).then(function(){n._ensureCommandOptions();var t=n._createAutomation();return t.TARGET_ELEMENT_FOUND_EVENT?t.on(t.TARGET_ELEMENT_FOUND_EVENT,function(t){n.targetElement=t.element,n.statusBar.hideWaitingElementStatus(!0),n.executionStartedHandler()}):(n.statusBar.hideWaitingElementStatus(!0),n.executionStartedHandler()),t.run(e)})},_l.prototype._runRecursively=function(){var e=this,t=!1,n=!0;return y.promiseUtils.whilst(function(){return!t},function(){return e._runAction(n).then(function(){t=!0}).catch(function(t){if(e._isExecutionTimeoutExpired()){if(t.message===_.ERROR_TYPES.foundElementIsNotTarget)return n=!1,l.Promise.resolve();throw t.message===_.ERROR_TYPES.elementIsInvisibleError?new ue:t}return y.delay(250)})})},_l.prototype.execute=function(){var i=this;return this.command.options&&!this.command.options.speed&&(this.command.options.speed=this.testSpeed),{startPromise:new l.Promise(function(t){i.executionStartedHandler=t}),completionPromise:new l.Promise(function(n){i.executionStartTime=new wl;try{i._ensureCommandArguments()}catch(t){return void n(new ao({isCommandResult:!0,executionError:t}))}i.commandSelectorTimeout=i._getSpecificTimeout(),i.statusBar.showWaitingElementStatus(i.commandSelectorTimeout);var t=Oo(function(){return i._runRecursively()}),e=t.actionPromise,r=t.barriersPromise;e.then(function(){return l.Promise.all([i._delayAfterExecution(),r])}).then(function(){var t={isCommandResult:!0},e=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(i.elements);i.targetElement&&(e[0]=i.targetElement),t.result=cr(new Ro).encode(e),n(new ao(t))}).catch(function(t){return i.statusBar.hideWaitingElementStatus(!1).then(function(){return n(new ao({isCommandResult:!0,executionError:t}))})})})}},_l);function _l(t,e,n,r){this.command=t,this.globalSelectorTimeout=e,this.statusBar=n,this.testSpeed=r,this.targetElement=null,this.elements=[],this.ensureElementsPromise=null,this.ensureElementsStartTime=null,this.executionStartTime=null,this.executionStartedHandler=null,this.commandSelectorTimeout=null}function El(t,e,n){return Math.min(Math.max(e,t),n)}function Cl(t,e){var n="number"==typeof t.min,r="number"==typeof t.max,i="number"==typeof t.length;return i&&(t.length=El(t.length,0,e)),n&&t.min<0&&(t.min+=e),r&&t.max<0&&(t.max+=e),n||(t.min=r&&i?t.max-t.length:0),r||(t.max=i?t.min+t.length:e),t.min=El(t.min,0,e),t.max=El(t.max,0,e),t.length=t.max-t.min,t}function Sl(t,e,n){return Math.round(t+El(e-t,0,n)/2)}var Il=l.eventSandbox.message,Tl="driver|browser-manipulation|request",bl="driver|browser-manipulation|response";Il.on(Il.SERVICE_MSG_RECEIVED_EVENT,function(e){var t,n,r,i,o;e.message.cmd===Tl&&(t=y.domUtils.findIframeByWindow(e.source),r=(n=e.message).command,(i=n.cropDimensions)&&(r.options=new Vs({crop:i,includePaddings:!1})),(o=new xl(r)).element=t,o.execute().then(function(t){return Il.sendServiceMsg({cmd:bl,result:t},e.source)}))});var xl=(Wl.prototype._getAbsoluteCropValues=function(){var t=this.element.getBoundingClientRect(),e=t.top,n=t.left;n+=this.command.options.originOffset.x,e+=this.command.options.originOffset.y;var r=n+this.command.options.crop.right,i=e+this.command.options.crop.bottom;return{top:e+=this.command.options.crop.top,left:n+=this.command.options.crop.left,bottom:i,right:r}},Wl.prototype._createManipulationReadyMessage=function(){var t=Ac.devicePixelRatio||1,e={cmd:f.readyForBrowserManipulation,pageDimensions:{dpr:t,innerWidth:Ac.innerWidth,innerHeight:Ac.innerHeight,documentWidth:Pc.documentElement.clientWidth,documentHeight:Pc.documentElement.clientHeight,bodyWidth:Pc.body.clientWidth,bodyHeight:Pc.body.clientHeight},disableResending:!0};return this.command.type===m.takeElementScreenshot&&(e.cropDimensions=this._getAbsoluteCropValues()),e},Wl.prototype._runScrollBeforeScreenshot=function(){var i=this;return l.Promise.resolve().then(function(){if(i.element||!i.command.selector)return l.Promise.resolve();var t=i.command.selector.timeout,e="number"==typeof t?t:i.globalSelectorTimeout;return i.statusBar.showWaitingElementStatus(e),zo([jo(i.command.selector)],i.globalSelectorTimeout).then(function(t){i.statusBar.hideWaitingElementStatus(),i.element=t[0]}).catch(function(t){throw i.statusBar.hideWaitingElementStatus(),t})}).then(function(){!function(t,e){var n=t.getBoundingClientRect(),r={left:n.left,right:n.right,top:n.top,bottom:n.bottom},i=y.styleUtils.getElementMargin(t),o=y.styleUtils.getElementPadding(t),s=y.styleUtils.getBordersWidth(t);e.originOffset={x:0,y:0};var a=r.left+t.scrollWidth+s.left+s.right,l=r.top+t.scrollHeight+s.top+s.bottom;r.right=Math.max(r.right,a),r.bottom=Math.max(r.bottom,l),e.includeBorders&&e.includePaddings?e.includeMargins&&(e.originOffset.x-=i.left,e.originOffset.y-=i.top,r.left-=i.left,r.top-=i.top,r.right+=i.right,r.bottom+=i.bottom):(e.originOffset.x+=s.left,e.originOffset.y+=s.top,r.left+=s.left,r.top+=s.top,r.right-=s.right,r.bottom-=s.bottom,e.includePaddings||(e.originOffset.x+=o.left,e.originOffset.y+=o.top,r.left+=o.left,r.top+=o.top,r.right-=o.right,r.bottom-=o.bottom)),r.width=r.right-r.left,r.height=r.bottom-r.top;var c=Cl({min:e.crop.left,max:e.crop.right,length:e.crop.width},r.width),u=Cl({min:e.crop.top,max:e.crop.bottom,length:e.crop.height},r.height);if(e.crop.left=c.min,e.crop.right=c.max,e.crop.width=c.length,e.crop.top=u.min,e.crop.bottom=u.max,e.crop.height=u.length,e.crop.width<=0||e.crop.height<=0)throw new Ke(e.crop.width,e.crop.height);var d=y.styleUtils.getViewportDimensions();(r.width>d.width||r.height>d.height)&&(e.scrollToCenter=!0);var h="number"==typeof e.scrollTargetX,f="number"==typeof e.scrollTargetY;h||(e.scrollTargetX=Sl(e.crop.left,e.crop.right,d.width)),f||(e.scrollTargetY=Sl(e.crop.top,e.crop.bottom,d.height));var m=_.getOffsetOptions(t,e.scrollTargetX,e.scrollTargetY),p=m.offsetX,g=m.offsetY;e.scrollTargetX=p,e.scrollTargetY=g;var v=!h||e.scrollTargetX>=e.crop.left&&e.scrollTargetX<=e.crop.right,w=!f||e.scrollTargetY>=e.crop.top&&e.scrollTargetY<=e.crop.bottom;if(!v||!w)throw new ze(v,w)}(i.element,i.command.options);var t=i.command.options,e=t.scrollTargetX,n=t.scrollTargetY,r=t.scrollToCenter;return new _.Scroll(i.element,new Bs({offsetX:e,offsetY:n,scrollToCenter:r,skipParentFrames:!0})).run()})},Wl.prototype._hideUI=function(){return n.hide(),this.command.markData&&n.showScreenshotMark(this.command.markData),y.delay(500)},Wl.prototype._showUI=function(){this.command.markData&&n.hideScreenshotMark(),n.show()},Wl.prototype._requestManipulation=function(){if(!ts(Ac))return l.transport.queuedAsyncServiceMsg(this._createManipulationReadyMessage());var t=this._getAbsoluteCropValues();return y.sendRequestToFrame({cmd:Tl,command:this.command,cropDimensions:t},bl,Ac.parent).then(function(t){if(!t.result)return{result:null};var e=t.result,n=e.result,r=e.executionError;if(r)throw r;return{result:n}})},Wl.prototype._runManipulation=function(){var r=this,i=null;return l.Promise.resolve().then(function(){return r.command.type!==m.takeElementScreenshot?l.Promise.resolve():(y.scrollController.stopPropagation(),r._runScrollBeforeScreenshot())}).then(function(){return ts(Ac)?l.Promise.resolve():r._hideUI()}).then(function(){return r._requestManipulation()}).then(function(t){var e=t.result,n=t.error;if(n)throw n;return y.scrollController.enablePropagation(),i=e,ts(Ac)||r._showUI(),y.delay(200)}).then(function(){return new ao({isCommandResult:!0,result:i})}).catch(function(t){return y.scrollController.enablePropagation(),new ao({isCommandResult:!0,executionError:t})})},Wl.prototype.execute=function(){var t=this;return Oo(function(){return t._runManipulation()}).barriersPromise},Wl);function Wl(t,e,n){this.command=t,this.globalSelectorTimeout=e,this.statusBar=n,this.element=null}function Ml(e){return e.getResult().then(function(t){return new ao({isCommandResult:!0,result:e.encodeResult(t)})}).catch(function(t){return new ao({isCommandResult:!0,executionError:t})})}var Al=o.Promise,Pl=(Dl.prototype.setAsMaster=function(t){return co(new Ni(t),this.driverWindow,uo,mn)},Dl.prototype.closeAllChildWindows=function(){return co(new Li,this.driverWindow,uo,vn)},Dl.prototype.findChildWindows=function(t,e){return co(new e(t),this.driverWindow,uo,mn)},Dl.prototype.startToRestore=function(){return co(new Bi,this.driverWindow,uo,mn)},Dl);function Dl(t,e){this.driverWindow=t,this.windowId=e}var Rl=(Nl.prototype._getTopOpenedWindow=function(t){for(var e=t;e.opener;)e=e.opener;return e.top},Nl.prototype._setAsMaster=function(t,e){return co(new Ni(e),t,uo,mn)},Nl.prototype.getTopOpenedWindow=function(){return this._getTopOpenedWindow(this.currentDriverWindow)},Nl.prototype.setTopOpenedWindowAsMaster=function(){var t=this._getTopOpenedWindow(this.currentDriverWindow);return this._setAsMaster(t)},Nl.prototype.setParentWindowAsMaster=function(t){void 0===t&&(t={});var e=this.currentDriverWindow.opener;return this._setAsMaster(e,t.finalizePendingCommand)},Nl.prototype.restoreChild=function(r){return c(this,void 0,void 0,function(){var e,n;return u(this,function(t){return e=new Vi(r),n=this.currentDriverWindow.opener,co(e,n,uo,mn),[2]})})},Nl);function Nl(t){this.currentDriverWindow=t}var kl,Fl="master",Ll="replica",Ul={isProxyless:!1,nativeMethods:l.nativeMethods,PromiseCtor:l.Promise,delay:y.delay,isShadowRoot:y.domUtils.isShadowRoot,isDomElement:y.domUtils.isDomElement,isTextNode:y.domUtils.isTextNode,isOptionElement:y.domUtils.isOptionElement,getTagName:y.domUtils.getTagName,isOptionElementVisible:n.selectElement.isOptionElementVisible,isElementVisible:y.positionUtils.isElementVisible,getActiveElement:y.domUtils.getActiveElement},Ol=o.settings,Bl=o.transport,Hl=o.Promise,Gl=o.eventSandbox.message,Vl=o.storages,Xl=o.nativeMethods,Yl=Xl.date,zl=o.eventSandbox.listeners,jl="testcafe|driver|test-done-sent-flag",ql="testcafe|driver|pending-status",Kl="testcafe|driver|executing-client-function-descriptor",Jl="testcafe|driver|selector-execution-start-time",$l="testcafe|driver|pending-page-error",Ql="testcafe|driver|active-iframe-selector",Zl="testcafe|driver|test-speed",tc="testcafe|driver|assertion-retries-timeout",ec="testcafe|driver|assertion-retries-start-time",nc="testcafe|driver|console-messages",rc="testcafe|driver|pending-child-window-count",ic={NotLoadedError:en,NotFoundError:ae,IsInvisibleError:ue},oc={NotLoadedError:on,NotFoundError:Vn,IsInvisibleError:zn},sc=Math.pow(2,31)-1,ac="status-with-command-result-event",lc="empty-command-event",cc="child-window-closed",uc=(s(dc,kl=y.serviceUtils.EventEmitter),dc.prototype._isOpenedInIframe=function(){var t=Ac.opener;return t&&t.top&&t.top!==t},Object.defineProperty(dc.prototype,"speed",{get:function(){return this.contextStorage.getItem(Zl)},set:function(t){this.contextStorage.setItem(Zl,t)},enumerable:!1,configurable:!0}),Object.defineProperty(dc.prototype,"consoleMessages",{get:function(){return new ir(this.contextStorage.getItem(nc))},set:function(t){return this.contextStorage.setItem(nc,t?t.getCopy():null)},enumerable:!1,configurable:!0}),dc.prototype._getReadyPromise=function(){return c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,y.eventUtils.documentReady(this.pageLoadTimeout)];case 1:return t.sent(),[4,this.pageInitialRequestBarrier.wait(!0)];case 2:return t.sent(),[2]}})})},dc.prototype._hasPendingActionFlags=function(t){return t.getItem(this.COMMAND_EXECUTING_FLAG)||t.getItem(this.EXECUTING_IN_IFRAME_FLAG)},dc.prototype._getCurrentWindowId=function(){var t=Ac.location.toString(),e=o.utils.url.parseProxyUrl(t);return e&&e.windowId||null},dc.prototype._onJsError=function(t){if(this.skipJsErrors||this.contextStorage.getItem(jl))return Hl.resolve();var e=new Nt(t.stack,t.pageUrl);return this.contextStorage.getItem($l)||this.contextStorage.setItem($l,e),null},dc.prototype._unlockPageAfterTestIsDone=function(){return y.disableRealEventsPreventing(),Hl.resolve()},dc.prototype._getActiveElement=function(){return c(this,void 0,void 0,function(){var e;return u(this,function(t){return e=y.domUtils.getActiveElement(),[2,this.replicator.encode(e)]})})},dc.prototype._failIfClientCodeExecutionIsInterrupted=function(){var t=this.contextStorage.getItem(Kl);return!!t&&(this._onReady(new ao({isCommandResult:!0,executionError:new yt(t.instantiationCallsiteName)})),!0)},dc.prototype.onCustomClientScriptError=function(t,e){var n=e?new zt(t,e):new Vt(t);this.contextStorage.getItem($l)||this.contextStorage.setItem($l,n)},dc.prototype._addChildWindowDriverLink=function(t){var e=new Pl(t.window,t.windowId);this.childWindowDriverLinks.push(e),this._ensureClosedChildWindowWatcher()},dc.prototype._ensureClosedChildWindowWatcher=function(){var e=this;this.checkClosedChildWindowIntervalId||(this.checkClosedChildWindowIntervalId=Xl.setInterval.call(Ac,function(){var t=y.arrayUtils.find(e.childWindowDriverLinks,function(t){return t.driverWindow.closed});t&&(e.emit(cc),y.arrayUtils.remove(e.childWindowDriverLinks,t),t.ignoreMasterSwitching||e._setCurrentWindowAsMaster(),e.childWindowDriverLinks.length||(Xl.clearInterval.call(Ac,e.checkClosedChildWindowIntervalId),delete e.checkClosedChildWindowIntervalId))},200))},dc.prototype._setAsMasterInProgressOrCompleted=function(){return this.setAsMasterInProgress||this.role===Fl},dc.prototype._setCurrentWindowAsMaster=function(){var t=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,this._clearActiveChildIframeInfo(),Hl.resolve().then(function(){return y.browser.setActiveWindowId(t.browserActiveWindowId,o.createNativeXHR,t.windowId)}).then(function(){t._startInternal({finalizePendingCommand:!0,isFirstRequestAfterWindowSwitching:!0}),t.setAsMasterInProgress=!1}).catch(function(){t._onReady(new ao({isCommandResult:!0,executionError:new mn}))}))},dc.prototype._onChildWindowOpened=function(t){this._addChildWindowDriverLink(t),this._switchToChildWindow(t.windowId)},dc.prototype._sendStartToRestoreCommand=function(){if(this.contextStorage){this._stopRespondToChildren=!0,this.contextStorage.setItem(rc,this.childWindowDriverLinks.length);for(var t=0,e=this.childWindowDriverLinks;t<e.length;t++)e[t].startToRestore()}},dc.prototype._onFormSubmit=function(t){this.contextStorage&&this.contextStorage.getItem(jl)&&(t.preventSubmit=!0)},dc.prototype._onConsoleMessage=function(t){var e=t.meth,n=t.line,r=this.consoleMessages;r.addMessage(e,n,this.windowId),this.consoleMessages=r},dc.prototype._addPendingErrorToStatus=function(t){var e=this.contextStorage.getItem($l);e&&(this.contextStorage.setItem($l,null),t.pageError=e)},dc.prototype._addUnexpectedDialogErrorToStatus=function(t){var e=this.nativeDialogsTracker.getUnexpectedDialogError();t.pageError=t.pageError||e},dc.prototype._addConsoleMessagesToStatus=function(t){t.consoleMessages=this.consoleMessages,this.consoleMessages=null},dc.prototype._addPendingWindowSwitchingStateToStatus=function(t){t.isPendingWindowSwitching=!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},dc.prototype._sendStatusRequest=function(t){function e(){return y.getTimeLimitedPromise(Bl.asyncServiceMsg(r),5e3)}function n(){return y.delay(300).then(e)}for(var r={cmd:f.ready,status:t,disableResending:!0,allowRejecting:!0},i=e(),o=0;o<h;o++)i=i.catch(n);return i},dc.prototype._sendStatus=function(t){var e=this;t.resent||(this._addPendingErrorToStatus(t),this._addUnexpectedDialogErrorToStatus(t),this._addConsoleMessagesToStatus(t),this._addPendingWindowSwitchingStateToStatus(t)),this.contextStorage.setItem(ql,t);var n=null;return y.pageUnloadBarrier.wait(0).then(function(){return e._sendStatusRequest(t)}).then(function(t){return n=t,y.pageUnloadBarrier.wait(0)}).then(function(){return e.contextStorage.setItem(ql,null),n})},dc.prototype._addChildIframeDriverLink=function(t,e){var n,r=this._getChildIframeDriverLinkByWindow(e);r||(n=this.testRunId+"-"+Ur(),r=new fo(e,n),this.childIframeDriverLinks.push(r)),r.sendConfirmationMessage(t)},dc.prototype._getTargetWindowNotFoundResult=function(t,e){return Hl.resolve({success:!1,errCode:t,errMsg:e})},dc.prototype._getChildWindowValidateResult=function(t){var e=t.find(function(t){return t.result.success});if(e)return e.result;var n=t.find(function(t){return t.result.errCode===rt||t.result.errCode===lt});return(n=n||t.find(function(t){return!!t.result.errCode}))?{errCode:n.result.errCode}:void 0},dc.prototype._handleWindowValidation=function(n,r,i,o){return c(this,void 0,void 0,function(){var e;return u(this,function(t){switch(t.label){case 0:return[4,this._validateWindow(n,r,i,o)];case 1:return e=t.sent(),ho({requestMsgId:n.id,window:r,result:e}),[2]}})})},dc.prototype._getWindowInfo=function(){var t=o.utils.url.parseProxyUrl(Ac.location.toString());return{id:this.windowId,title:Pc.title,url:t.destUrl}},dc.prototype._isTargetWindow=function(t){return t.windowId===this.windowId},dc.prototype._validateWindow=function(r,t,i,o){return c(this,void 0,void 0,function(){var e,n;return u(this,function(t){switch(t.label){case 0:return this._isTargetWindow(r)?[2,i()]:this.childWindowDriverLinks.length?(e=this.childWindowDriverLinks.map(function(t){return t.findChildWindows(r,o)}),[4,Hl.all(e)]):[2,this._getTargetWindowNotFoundResult(it)];case 1:return n=t.sent(),[2,this._getChildWindowValidateResult(n)]}})})},dc._createWindowValidationError=function(t){var e=t.errCode;return new(e===rt?_n:e===lt?In:Wn)},dc.prototype._getCloseWindowFoundResult=function(){return this.parentWindowDriverLink?this.childWindowDriverLinks.length?Hl.resolve({success:!1,errCode:rt}):Hl.resolve({success:!0}):Hl.resolve({success:!1,errCode:lt})},dc.prototype._handleCloseWindowValidation=function(t,e){var n=this;return this._handleWindowValidation(t,e,function(){return n._getCloseWindowFoundResult()},ai)},dc.prototype._handleSwitchToWindowValidation=function(t,e){return this._handleWindowValidation(t,e,function(){return Hl.resolve({success:!0})},ui)},dc.prototype._handleCloseWindow=function(e,n){return c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this._closeWindow(e,n)];case 1:return t.sent(),ho({requestMsgId:e.id,window:n}),[2]}})})},dc.prototype._closeWindowAndWait=function(t,e){var n=this._createWaitForEventPromise(cc,2e3);return t.ignoreMasterSwitching=!e.isCurrentWindow,t.driverWindow.close(),n},dc.prototype._closeWindow=function(e){if(!this.childWindowDriverLinks.length)return Hl.resolve();var t=this.childWindowDriverLinks.find(function(t){return t.windowId===e.windowId});if(t)return this._closeWindowAndWait(t,e);var n=this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,gi)});return Hl.all(n)},dc.prototype._getWindows=function(){return c(this,void 0,void 0,function(){var e,n,r,i,o,s;return u(this,function(t){switch(t.label){case 0:return this.childWindowDriverLinks.length?(e=this.childWindowDriverLinks.map(function(t){return t.findChildWindows({},fi)}),[4,Hl.all(e)]):[2,[this._getWindowInfo()]];case 1:for(n=t.sent(),r=[this._getWindowInfo()],i=0,o=n;i<o.length;i++)s=o[i],Array.isArray(s.result)&&(r=r.concat(s.result));return[2,r]}})})},dc.prototype._handleGetWindows=function(n,r){return c(this,void 0,void 0,function(){var e;return u(this,function(t){switch(t.label){case 0:return[4,this._getWindows(n,r)];case 1:return e=t.sent(),ho({requestMsgId:n.id,window:r,result:e}),[2]}})})},dc.prototype._handleSwitchToWindow=function(e,n){return c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this._switchToWindow(e)];case 1:return t.sent(),ho({requestMsgId:e.id,window:n}),[2]}})})},dc.prototype._switchToWindow=function(e){var t=this;return this._isTargetWindow(e)?Hl.resolve().then(function(){t._setCurrentWindowAsMaster()}):this.childWindowDriverLinks.length?Hl.all(this.childWindowDriverLinks.map(function(t){return t.findChildWindows(e,yi)})):Hl.resolve()},dc.prototype._handleSetAsMasterMessage=function(t,e){var n=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,ho({requestMsgId:t.id,window:e}),Hl.resolve().then(function(){return y.browser.setActiveWindowId(n.browserActiveWindowId,o.createNativeXHR,n.windowId)}).then(function(){n._startInternal({finalizePendingCommand:t.finalizePendingCommand,result:{id:n.windowId}}),n.setAsMasterInProgress=!1}).catch(function(){n._onReady(new ao({isCommandResult:!0,executionError:new mn}))}))},dc.prototype._handleCloseAllWindowsMessage=function(t,e){var n=this;this._closeAllChildWindows().then(function(){ho({requestMsgId:t.id,window:e})}).catch(function(){n._onReady(new ao({isCommandResult:!0,executionError:new vn}))})},dc.prototype._handleStartToRestoreChildLinkMessage=function(){this.parentWindowDriverLink.restoreChild(this._getCurrentWindowId())},dc.prototype._handleHasPendingActionFlags=function(t,e){var n=this._hasPendingActionFlags(this.contextStorage);ho({requestMsgId:t.id,window:e,result:n})},dc.prototype._handleRestoreChildLink=function(t,e){this._stopRespondToChildren||(this._addChildWindowDriverLink({window:e,windowId:t.windowId}),this.childWindowDriverLinks.length===this.contextStorage.getItem(rc)&&this._restoreChildWindowsPromiseResolver&&(this._restoreChildWindowsPromiseResolver(),delete this._restoreChildWindowsPromiseResolver,this.contextStorage.setItem(rc,0)),ho({requestMsgId:t.id,window:e}))},dc.prototype._handleChildWindowIsOpenedInIFrame=function(){var e=this;this._pendingChildWindowInIFrame=new Hl(function(t){e._resolvePendingChildWindowInIframe=t})},dc.prototype._handleChildWindowIsLoadedInIFrame=function(e,t){ho({requestMsgId:e.id,window:t}),this._resolvePendingChildWindowInIframe(),this.childWindowDriverLinks.find(function(t){return t.windowId===e.windowId})||this._onChildWindowOpened({window:t,windowId:e.windowId})},dc.prototype._initChildDriverListening=function(){var r=this;Gl.on(Gl.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message,n=t.source;switch(e.type){case Hr:r._addChildIframeDriverLink(e.id,n);break;case ni:r._handleChildWindowIsOpenedInIFrame(e,n);break;case ei:r._handleChildWindowIsLoadedInIFrame(e,n);break;case $r:r._handleSetAsMasterMessage(e,n);break;case Gr:r._handleSwitchToWindow(e,n);break;case Vr:r._handleCloseWindow(e,n);break;case Yr:r._handleSwitchToWindowValidation(e,n);break;case Xr:r._handleCloseWindowValidation(e,n);break;case zr:r._handleGetWindows(e,n);break;case Qr:r._handleCloseAllWindowsMessage(e,n);break;case Zr:r._handleStartToRestoreChildLinkMessage();break;case ri:r._handleHasPendingActionFlags(e,n);break;case ti:r._handleRestoreChildLink(e,n)}})},dc.prototype._getChildIframeDriverLinkByWindow=function(e){return y.arrayUtils.find(this.childIframeDriverLinks,function(t){return t.driverWindow===e})},dc.prototype._getChildWindowDriverLinkByWindow=function(e){return y.arrayUtils.find(this.childWindowDriverLinks,function(t){return t.driverWindow===e})},dc.prototype._runInActiveIframe=function(t){var e=this,n=Hl.resolve(),r=this.contextStorage.getItem(Ql);!this.activeChildIframeDriverLink&&r&&(n=this._switchToIframe(r,oc)),n.then(function(){return e.contextStorage.setItem(e.EXECUTING_IN_IFRAME_FLAG,!0),e.activeChildIframeDriverLink.executeCommand(t,e.speed)}).then(function(t){return e._onCommandExecutedInIframe(t)}).catch(function(t){return e._onCommandExecutedInIframe(new ao({isCommandResult:!0,executionError:t}))})},dc.prototype._onCommandExecutedInIframe=function(t){var e=this;this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1);var n=Hl.resolve();this._pendingChildWindowInIFrame&&(n=this._pendingChildWindowInIFrame),n.then(function(){e._onReady(t)})},dc.prototype._ensureChildIframeDriverLink=function(t,e,n){var r=this;return y.waitFor(function(){return r._getChildIframeDriverLinkByWindow(t)},500,n).catch(function(){throw new e})},dc.prototype._ensureChildWindowDriverLink=function(t,e,n){var r=this;return y.waitFor(function(){return r._getChildWindowDriverLinkByWindow(t)},500,n).catch(function(){throw new e})},dc.prototype._switchToIframe=function(e,n){var t,r,i,o,s,a,l,c=this,u="number"==typeof e.timeout?e.timeout:this.selectorTimeout;return t=e,r=u,i=null,o=function(t){return new n.NotFoundError(t)},s=function(){return new n.IsInvisibleError},a=this.statusBar,l=new Ho(t,r,i,o,s),a.showWaitingElementStatus(l.timeout),l.getResult().then(function(t){return a.hideWaitingElementStatus(!!t).then(function(){return t})}).catch(function(t){return a.hideWaitingElementStatus(!1).then(function(){throw t})}).then(function(t){if(!y.domUtils.isIframeElement(t))throw new Qe;return Ac["%switchedIframe%"]=t,c._ensureChildIframeDriverLink(Xl.contentWindowGetter.call(t),n.NotLoadedError,u)}).then(function(t){t.availabilityTimeout=u,c.activeChildIframeDriverLink=t,c.contextStorage.setItem(Ql,e)})},dc.prototype._createWaitForEventPromise=function(e,n){var r=this,i=null,t=new Hl(function(t){Xl.setTimeout.call(Ac,function(){r.off(e,i),t()},n)}),o=new Hl(function(t){i=function(){this.off(e,i),t()},r.on(e,i)});return Hl.race([t,o])},dc.prototype._waitForCurrentCommandCompletion=function(){return this.contextStorage.getItem(this.COMMAND_EXECUTING_FLAG)?this._createWaitForEventPromise(ac,sc):Hl.resolve()},dc.prototype._waitForEmptyCommand=function(){return this._createWaitForEventPromise(lc,3e4)},dc.prototype._abortSwitchingToChildWindowIfItClosed=function(){if(this.activeChildWindowDriverLink.driverWindow.closed)throw y.arrayUtils.remove(this.childWindowDriverLinks,this.activeChildWindowDriverLink),this.activeChildWindowDriverLink=null,new Ln},dc.prototype._switchToChildWindow=function(t){var e=this;this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0);var n=this.contextStorage.getItem(this.WINDOW_COMMAND_API_CALL_FLAG);return function(e,t){if("string"!=typeof e)return Al.resolve(null);var n=y.arrayUtils.find(t,function(t){return t.windowId===e});if(n)return Al.resolve(n);var r=new ln;return Al.reject(r)}(t,this.childWindowDriverLinks).then(function(t){return e._ensureChildWindowDriverLink(t.driverWindow,dn,e.childWindowReadyTimeout)}).then(function(t){return e.activeChildWindowDriverLink=t,e._waitForCurrentCommandCompletion()}).then(function(){return n?void 0:e._waitForEmptyCommand()}).then(function(){return e._abortSwitchingToChildWindowIfItClosed(),e._stopInternal(),e.activeChildWindowDriverLink.setAsMaster(n)}).then(function(){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(t){e.contextStorage.setItem(e.PENDING_WINDOW_SWITCHING_FLAG,!1),t instanceof Ln?e._onReady(new ao):e._onReady(new ao({isCommandResult:!0,executionError:new mn}))})},dc.prototype._switchToTopParentWindow=function(){var t=this.parentWindowDriverLink.setTopOpenedWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(t)},dc.prototype._switchToParentWindow=function(t){void 0===t&&(t={});var e=this.parentWindowDriverLink.setParentWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(e,t)},dc.prototype._switchToParentWindowInternal=function(t,e){var n=this;return void 0===e&&(e={}),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0),Hl.resolve().then(function(){return n._stopInternal(),t(e)}).then(function(){n.contextStorage.setItem(n.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(){n.contextStorage.setItem(n.PENDING_WINDOW_SWITCHING_FLAG,!1),n._onReady(new ao({isCommandResult:!0,executionError:new mn}))})},dc.prototype._switchToMainWindow=function(t){this.activeChildIframeDriverLink&&this.activeChildIframeDriverLink.executeCommand(t),this._clearActiveChildIframeInfo()},dc.prototype._clearActiveChildIframeInfo=function(){this.contextStorage.setItem(Ql,null),this.activeChildIframeDriverLink=null},dc.prototype._setNativeDialogHandlerInIframes=function(t){for(var e=new Pi(t),n=0;n<this.childIframeDriverLinks.length;n++)Gl.sendServiceMsg(e,this.childIframeDriverLinks[n].driverWindow)},dc.prototype._onActionCommand=function(t){var e,n,r,i,o=this,s=(e=t,n=this.selectorTimeout,r=this.statusBar,i=this.speed,new yl(e,n,r,i).execute()),a=s.startPromise,l=s.completionPromise;a.then(function(){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!0)}),l.then(function(t){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!1),o._onReady(t)})},dc.prototype._onSetNativeDialogHandlerCommand=function(t){this.nativeDialogsTracker.setHandler(t.dialogHandler),this._setNativeDialogHandlerInIframes(t.dialogHandler),this._onReady(new ao({isCommandResult:!0}))},dc.prototype._onGetNativeDialogHistoryCommand=function(){this._onReady(new ao({isCommandResult:!0,result:this.nativeDialogsTracker.appearedDialogs}))},dc.prototype._onGetBrowserConsoleMessagesCommand=function(){this._onReady(new ao({isCommandResult:!0}))},dc.prototype._onNavigateToCommand=function(t){var e=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),function(r){return c(this,void 0,void 0,function(){var e,n;return u(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=new y.RequestBarrier,l.navigateTo(r.url,r.forceReload),[4,l.Promise.all([e.wait(),y.pageUnloadBarrier.wait()])];case 1:return t.sent(),[2,new ao({isCommandResult:!0})];case 2:return n=t.sent(),[2,new ao({isCommandResult:!0,executionError:n})];case 3:return[2]}})})}(t).then(function(t){return e.contextStorage.setItem(e.COMMAND_EXECUTING_FLAG,!1),e._onReady(t)})},dc.prototype._onExecuteClientFunctionCommand=function(t){var e=this;this.contextStorage.setItem(Kl,{instantiationCallsiteName:t.instantiationCallsiteName}),Ml(new Ir(t)).then(function(t){e.contextStorage.setItem(Kl,null),e._onReady(t)})},dc.prototype._onExecuteSelectorCommand=function(t){var e,n,r,i,o,s,a,l=this,c=this.contextStorage.getItem(Jl)||new Yl,u=t.needError?function(t){return new Pt(null,t)}:null;e=t,n=this.selectorTimeout,r=c,o=i=u,s=this.statusBar,a=new Ho(e,n,r,i,o),s.showWaitingElementStatus(a.timeout),Ml(a).then(function(t){return s.hideWaitingElementStatus(!!t.result).then(function(){return t})}).then(function(t){l.contextStorage.setItem(Jl,null),l._onReady(t)})},dc.prototype._onSwitchToMainWindowCommand=function(t){this._switchToMainWindow(t),this._onReady(new ao({isCommandResult:!0}))},dc.prototype._onSwitchToIframeCommand=function(t){var e=this;this._switchToIframe(t.selector,ic).then(function(){return e._onReady(new ao({isCommandResult:!0}))}).catch(function(t){return e._onReady(new ao({isCommandResult:!0,executionError:t}))})},dc.prototype._onWindowOpenCommand=function(t){this.contextStorage.setItem(this.WINDOW_COMMAND_API_CALL_FLAG,!0),Ac.open(t.url)},dc.prototype._onWindowCloseCommand=function(a){return c(this,void 0,void 0,function(){var e,n,r,i,o,s;return u(this,function(t){switch(t.label){case 0:e=this._getTopOpenedWindow(),n=a.windowId||this.windowId,r=n===this.windowId,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,this._validateChildWindowCloseCommandExists(n,e)];case 2:if(i=t.sent(),!(o=i.result).success)throw dc._createWindowValidationError(o);return[4,co(new gi({windowId:n,isCurrentWindow:r}),e,uo,mn)];case 3:return t.sent(),r||this._onReady(new ao({isCommandResult:!0})),[3,5];case 4:return s=t.sent(),this._onReady(new ao({isCommandResult:!0,executionError:s})),[3,5];case 5:return[2]}})})},dc.prototype._onGetCurrentWindowCommand=function(){this._onReady(new ao({isCommandResult:!0,result:{id:this.windowId}}))},dc.prototype._onGetWindowsCommand=function(){return c(this,void 0,void 0,function(){var e,n;return u(this,function(t){switch(t.label){case 0:return e=this._getTopOpenedWindow(),[4,co(new fi,e,uo,mn)];case 1:return n=t.sent(),this._onReady(new ao({isCommandResult:!0,result:n.result})),[2]}})})},dc.prototype._validateChildWindowCloseCommandExists=function(t,e){return co(new ai({windowId:t}),e,uo,mn)},dc.prototype._validateChildWindowSwitchToWindowCommandExists=function(t,e){var n=t.windowId,r=t.fn;return co(new ui({windowId:n,fn:r}),e,uo,mn)},dc.prototype._getTopOpenedWindow=function(){var t;return((null===(t=this.parentWindowDriverLink)||void 0===t?void 0:t.getTopOpenedWindow())||Ac).top},dc.prototype._onSwitchToWindow=function(i,o){return c(this,void 0,void 0,function(){var e,n,r;return u(this,function(t){switch(t.label){case 0:return e=this._getTopOpenedWindow(),[4,this._validateChildWindowSwitchToWindowCommandExists({windowId:i.windowId,fn:i.checkWindow},e)];case 1:return n=t.sent(),(r=n.result).success?(this._stopInternal(),co(new yi({windowId:i.windowId,fn:i.checkWindow}),e,uo,mn)):this._onReady(new ao({isCommandResult:!0,executionError:o||dc._createWindowValidationError(r)})),[2]}})})},dc.prototype._restoreChildWindowLinks=function(){return c(this,void 0,void 0,function(){var e,n=this;return u(this,function(t){switch(t.label){case 0:if(!this.contextStorage.getItem(rc))return[2];e=new Hl(function(t){n._restoreChildWindowsPromiseResolver=t}),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,y.getTimeLimitedPromise(e,3e4)];case 2:return t.sent(),[3,4];case 3:return t.sent(),this._onReady(new ao({isCommandResult:!0,executionError:new Bn})),[3,4];case 4:return[2]}})})},dc.prototype._onSwitchToPreviousWindow=function(t){this._onSwitchToWindow(t,new Nn)},dc.prototype._onSwitchToParentWindow=function(){this.parentWindowDriverLink?this._switchToParentWindow({finalizePendingCommand:!0}):this._onReady(new ao({isCommandResult:!0,executionError:new Pn}))},dc.prototype._onBrowserManipulationCommand=function(t){var e,n,r,i=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),e=t,n=this.selectorTimeout,r=this.statusBar,new xl(e,n,r).execute().then(function(t){return i.contextStorage.setItem(i.COMMAND_EXECUTING_FLAG,!1),i._onReady(t)})},dc.prototype._onSetBreakpointCommand=function(t){var n=this,e=t.isTestError,r=t.inCompilerService,i=this.statusBar.showDebuggingStatus(e);r?(i.then(function(t){n.debug=t}),this._onReady(new ao({isCommandResult:!0,result:!0}))):i.then(function(t){var e=t===pt;n._onReady(new ao({isCommandResult:!0,result:e}))})},dc.prototype._onDisableDebugCommand=function(){this.statusBar._resetState(),this._onReady(new ao({isCommandResult:!0}))},dc.prototype._onSetTestSpeedCommand=function(t){this.speed=t.speed,this._onReady(new ao({isCommandResult:!0}))},dc.prototype._onShowAssertionRetriesStatusCommand=function(t){this.contextStorage.setItem(tc,t.timeout),this.contextStorage.setItem(ec,Xl.dateNow()),this.statusBar.showWaitingAssertionRetriesStatus(t.timeout),this._onReady(new ao({isCommandResult:!0}))},dc.prototype._onHideAssertionRetriesStatusCommand=function(t){var e=this;this.contextStorage.setItem(tc,null),this.contextStorage.setItem(ec,null),this.statusBar.hideWaitingAssertionRetriesStatus(t.success).then(function(){return e._onReady(new ao({isCommandResult:!0}))})},dc.prototype._checkStatus=function(){var r=this;return y.browser.checkStatus(this.browserStatusDoneUrl,o.createNativeXHR,{manualRedirect:!0}).then(function(t){var e=t.command,n=t.redirecting;n&&e.url.indexOf(r.testRunId)<0?(Vl.clear(),Vl.lock()):r.contextStorage.setItem(jl,!1),n?y.browser.redirect(e):r._onReady({isCommandResult:!1})}).catch(function(){return y.delay(1e3)})},dc.prototype._onCustomCommand=function(t){var e=this;(0,this.customCommandHandlers[t.type].handler)(t).then(function(t){e._onReady(new ao({isCommandResult:!0,result:t}))})},dc.prototype._closeAllChildWindows=function(){var t=this;return this.childWindowDriverLinks.length?Hl.all(this.childWindowDriverLinks.map(function(t){return t.closeAllChildWindows()})).then(function(){Xl.arrayForEach.call(t.childWindowDriverLinks,function(t){t.driverWindow.close()})}):Hl.resolve()},dc.prototype._onTestDone=function(t){var e=this;this.contextStorage.setItem(jl,!0),this.parentWindowDriverLink?this._switchToTopParentWindow():this._closeAllChildWindows().then(function(){return e._sendStatus(t)}).then(function(){e._checkStatus()}).catch(function(){e._onReady(new ao({isCommandResult:!0,executionError:vn}))})},dc.prototype._onBackupStoragesCommand=function(){this._onReady(new ao({isCommandResult:!0,result:Vl.backup()}))},dc.prototype._isStatusWithCommandResultInPendingWindowSwitchingMode=function(t){return t.isCommandResult&&!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},dc.prototype._isEmptyCommandInPendingWindowSwitchingMode=function(t){return!t&&!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},dc.prototype._onReady=function(t){var e=this;this.debug&&(t.debug=this.debug,this.debug=null),this._isStatusWithCommandResultInPendingWindowSwitchingMode(t)&&this.emit(ac),this._sendStatus(t).then(function(t){if(t)e._onCommand(t);else{if(e._isEmptyCommandInPendingWindowSwitchingMode(t))return void e.emit(lc);e._onReady(new ao)}})},dc.prototype._executeCommand=function(t){this.contextStorage.setItem(this.WINDOW_COMMAND_API_CALL_FLAG,!1),this.customCommandHandlers[t.type]?this._onCustomCommand(t):t.type===m.testDone?this._onTestDone(new ao({isCommandResult:!0})):t.type===m.setBreakpoint?this._onSetBreakpointCommand(t):t.type===m.disableDebug?this._onDisableDebugCommand():t.type===m.switchToMainWindow?this._onSwitchToMainWindowCommand(t):t.type===m.switchToIframe?this._onSwitchToIframeCommand(t):t.type===m.openWindow?this._onWindowOpenCommand(t):t.type===m.closeWindow?this._onWindowCloseCommand(t):t.type===m.getCurrentWindow?this._onGetCurrentWindowCommand(t):t.type===m.getCurrentWindows?this._onGetWindowsCommand():t.type===m.switchToWindow?this._onSwitchToWindow(t):t.type===m.switchToPreviousWindow?this._onSwitchToPreviousWindow(t):t.type===m.switchToParentWindow?this._onSwitchToParentWindow():ht(t)?this._onBrowserManipulationCommand(t):t.type===m.executeClientFunction?this._onExecuteClientFunctionCommand(t):t.type===m.executeSelector?this._onExecuteSelectorCommand(t):t.type===m.navigateTo?this._onNavigateToCommand(t):t.type===m.setNativeDialogHandler?this._onSetNativeDialogHandlerCommand(t):t.type===m.getNativeDialogHistory?this._onGetNativeDialogHistoryCommand(t):t.type===m.getBrowserConsoleMessages?this._onGetBrowserConsoleMessagesCommand(t):t.type===m.setTestSpeed?this._onSetTestSpeedCommand(t):t.type===m.showAssertionRetriesStatus?this._onShowAssertionRetriesStatusCommand(t):t.type===m.hideAssertionRetriesStatus?this._onHideAssertionRetriesStatusCommand(t):t.type===m.backupStorages?this._onBackupStoragesCommand():this._onActionCommand(t)},dc.prototype._isExecutableInTopWindowOnly=function(t){if((e=t).type===m.testDone||e.type===m.switchToMainWindow||e.type===m.setNativeDialogHandler||e.type===m.getNativeDialogHistory||e.type===m.setTestSpeed||e.type===m.showAssertionRetriesStatus||e.type===m.hideAssertionRetriesStatus||e.type===m.setBreakpoint||ht(e)&&e.type!==m.takeElementScreenshot)return!0;var e,n=this.customCommandHandlers[t.type];return t.forceExecutionInTopWindowOnly||n&&n.isExecutableInTopWindowOnly},dc.prototype._onCommand=function(n){var r=this;this.readyPromise.then(function(){var t,e=ut(n);r.contextStorage.getItem($l)&&e?r._onReady(new ao({isCommandResult:!0})):(t=r.activeChildIframeDriverLink||r.contextStorage.getItem(Ql),r._isExecutableInTopWindowOnly(n)||!t?r._executeCommand(n):r._runInActiveIframe(n))})},dc.prototype.setCustomCommandHandlers=function(t,e,n){this.customCommandHandlers[t]={isExecutableInTopWindowOnly:n,handler:e}},dc.prototype._startInternal=function(t){this.role=Fl,y.browser.startHeartbeat(this.heartbeatUrl,o.createNativeXHR),this._setupAssertionRetryIndication(),this._startCommandsProcessing(t)},dc.prototype._stopInternal=function(){this.role=Ll,y.browser.stopHeartbeat(),_.cursor.hide()},dc.prototype._setupAssertionRetryIndication=function(){var n=this;this.readyPromise.then(function(){n.statusBar.hidePageLoadingStatus();var t,e=n.contextStorage.getItem(tc);e&&(t=n.contextStorage.getItem(ec),0<e-(new Yl-t)&&n.statusBar.showWaitingAssertionRetriesStatus(e,t))})},dc.prototype._startCommandsProcessing=function(t){void 0===t&&(t={finalizePendingCommand:!1,isFirstRequestAfterWindowSwitching:!1,result:void 0});var e,n,r=this.contextStorage.getItem(ql);r&&(r.resent=!0),this.contextStorage.getItem(jl)?r?this._onTestDone(r):this._checkStatus():this._failIfClientCodeExecutionIsInterrupted()||(e=t.finalizePendingCommand||this._hasPendingActionFlags(this.contextStorage),n=r||new ao({isCommandResult:e,isFirstRequestAfterWindowSwitching:t.isFirstRequestAfterWindowSwitching,result:t.result}),this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!1),this._onReady(n))},dc.prototype._initParentWindowLink=function(){Ac.opener&&Ac.opener!==Ac&&this.windowId&&(this.parentWindowDriverLink=new Rl(Ac))},dc.prototype._initConsoleMessages=function(){var t=this.consoleMessages;t.ensureMessageContainer(this.windowId),this.consoleMessages=t},dc.prototype._getDriverRole=function(){return c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return this.windowId?[4,y.browser.getActiveWindowId(this.browserActiveWindowId,o.createNativeXHR)]:[2,Fl];case 1:return[2,t.sent().activeWindowId===this.windowId?Fl:Ll]}})})},dc.prototype._init=function(){this.contextStorage=new no(Ac,this.testRunId,this.windowId),this.nativeDialogsTracker=new Fr(this.contextStorage,this.dialogHandler),this.statusBar=new n.StatusBar(this.userAgent,this.fixtureName,this.testName,this.contextStorage),this.statusBar.on(this.statusBar.UNLOCK_PAGE_BTN_CLICK,y.disableRealEventsPreventing),this.speed=this.initialSpeed,this._initConsoleMessages(),this._initParentWindowLink(),this._isOpenedInIframe()&&co(new zi(this.windowId),Ac.opener.top,uo,Wn)},dc.prototype._doFirstPageLoadSetup=function(){return c(this,void 0,void 0,function(){return u(this,function(t){return this.isFirstPageLoad&&this.canUseDefaultWindowActions,[2]})})},dc.prototype.start=function(){return c(this,void 0,void 0,function(){var e;return u(this,function(t){switch(t.label){case 0:return this._init(),[4,this._doFirstPageLoadSetup()];case 1:return t.sent(),[4,this._restoreChildWindowLinks()];case 2:return t.sent(),[4,this._getDriverRole()];case 3:return e=t.sent(),this.role===Fl||e===Fl&&this._startInternal(),[2]}})})},dc);function dc(t,e,n,r){var i=kl.call(this)||this;return i.COMMAND_EXECUTING_FLAG="testcafe|driver|command-executing-flag",i.EXECUTING_IN_IFRAME_FLAG="testcafe|driver|executing-in-iframe-flag",i.PENDING_WINDOW_SWITCHING_FLAG="testcafe|driver|pending-window-switching-flag",i.WINDOW_COMMAND_API_CALL_FLAG="testcafe|driver|window-command-api-flag",i.testRunId=t,i.heartbeatUrl=e.heartbeat,i.browserStatusUrl=e.status,i.browserStatusDoneUrl=e.statusDone,i.browserActiveWindowId=e.activeWindowId,i.userAgent=n.userAgent,i.fixtureName=n.fixtureName,i.testName=n.testName,i.selectorTimeout=r.selectorTimeout,i.pageLoadTimeout=r.pageLoadTimeout,i.childWindowReadyTimeout=r.childWindowReadyTimeout,i.initialSpeed=r.speed,i.skipJsErrors=r.skipJsErrors,i.dialogHandler=r.dialogHandler,i.canUseDefaultWindowActions=r.canUseDefaultWindowActions,i.isFirstPageLoad=Ol.get().isFirstPageLoad,function(t){if(t.nativeMethods.objectAssign)t.nativeMethods.objectAssign(dr,t);else for(var e=0,n=t.nativeMethods.objectKeys(t);e<n.length;e++){var r=n[e];dr[r]=t[r]}}(Ul),i.customCommandHandlers={},i.contextStorage=null,i.nativeDialogsTracker=null,i.childIframeDriverLinks=[],i.activeChildIframeDriverLink=null,i.childWindowDriverLinks=[],i.parentWindowDriverLink=null,i.statusBar=null,i.windowId=i._getCurrentWindowId(),i.role=Ll,i.setAsMasterInProgress=!1,i.checkClosedChildWindowIntervalId=null,i.pageInitialRequestBarrier=new y.RequestBarrier,i.readyPromise=i._getReadyPromise(),i._initChildDriverListening(),y.pageUnloadBarrier.init(),y.preventRealEvents(),o.on(o.EVENTS.uncaughtJsError,function(t){return i._onJsError(t)}),o.on(o.EVENTS.unhandledRejection,function(t){return i._onJsError(t)}),o.on(o.EVENTS.consoleMethCalled,function(t){return i._onConsoleMessage(t)}),o.on(o.EVENTS.beforeFormSubmit,function(t){return i._onFormSubmit(t)}),o.on(o.EVENTS.windowOpened,function(t){return i._onChildWindowOpened(t)}),i.setCustomCommandHandlers(m.unlockPage,function(){return i._unlockPageAfterTestIsDone()}),i.setCustomCommandHandlers(m.getActiveElement,function(){return i._getActiveElement()}),zl.addInternalEventBeforeListener(Ac,["beforeunload"],function(){i._sendStartToRestoreCommand()}),i.replicator=cr([new Po]),i}var hc=(fc.prototype.establishConnection=function(){return co(new ii,this.driverWindow,5e3,on).then(function(t){return t.result.id})},fc.prototype.sendConfirmationMessage=function(t){ho({requestMsgId:t,window:this.driverWindow})},fc.prototype.onCommandExecuted=function(t){var e=new Ci(t);l.eventSandbox.message.sendServiceMsg(e,this.driverWindow)},fc.prototype.hasPendingActionFlags=function(){return c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,co(new Qi,this.driverWindow,5e3,on)];case 1:return[2,t.sent().result]}})})},fc);function fc(t){this.driverWindow=t}var mc,pc=o.eventSandbox.message,gc=(s(vc,mc=Fr),vc.prototype._defaultDialogHandler=function(t){pc.sendServiceMsg({type:xr,dialogType:t,url:Fr._getPageUrl()},Ac.top)},vc.prototype._addAppearedDialogs=function(t,e){pc.sendServiceMsg({type:br,dialogType:t,text:e,url:Fr._getPageUrl()},Ac.top)},vc.prototype._onHandlerError=function(t,e){pc.sendServiceMsg({type:Wr,dialogType:t,message:e,url:Fr._getPageUrl()},Ac.top)},vc);function vc(t){return mc.call(this,null,t)||this}var wc,yc=l.eventSandbox.message,_c=(s(Ec,wc=uc),Ec.prototype._onJsError=function(){},Ec.prototype._onConsoleMessage=function(){},Ec.prototype._onChildWindowOpened=function(){yc.sendServiceMsg(new Ki,Ac.top)},Ec.prototype._initParentDriverListening=function(){var n=this;l.eventSandbox.message.on(l.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,function(t){var e=t.message;y.pageUnloadBarrier.wait(0).then(function(){if(e.type===qr){if(n.lastParentDriverMessageId===e.id)return;n.lastParentDriverMessageId=e.id,n.readyPromise.then(function(){n.speed=e.testSpeed,n.parentDriverLink.sendConfirmationMessage(e.id),n._onCommand(e.command)})}e.type===Jr&&(n.nativeDialogsTracker.setHandler(e.dialogHandler),n._setNativeDialogHandlerInIframes(e.dialogHandler))})})},Ec.prototype._onSwitchToMainWindowCommand=function(t){this._switchToMainWindow(t)},Ec.prototype._onReady=function(t){this.parentDriverLink.onCommandExecuted(t)},Ec.prototype._isInCommandExecution=function(){return c(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return l.utils.dom.isCrossDomainWindows(Ac,Ac.parent)?[4,this.parentDriverLink.hasPendingActionFlags()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,this._hasPendingActionFlags(this.contextStorage)]}})})},Ec.prototype._init=function(){return c(this,void 0,void 0,function(){var e;return u(this,function(t){switch(t.label){case 0:return[4,this.parentDriverLink.establishConnection()];case 1:return e=t.sent(),this.contextStorage=new no(Ac,e,this.windowId),this._failIfClientCodeExecutionIsInterrupted()?[2]:[4,this._isInCommandExecution()];case 2:return t.sent()&&(this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this._onReady(new ao({isCommandResult:!0}))),[2]}})})},Ec.prototype.start=function(){this.nativeDialogsTracker=new gc(this.dialogHandler),this.statusBar=new n.IframeStatusBar;var t=this._init();this.readyPromise=l.Promise.all([this.readyPromise,t])},Ec);function Ec(t,e){var n=wc.call(this,t,{},{},e)||this;return n.lastParentDriverMessageId=null,n.parentDriverLink=new hc(Ac.parent),n._initParentDriverListening(),n}var Cc={NodeSnapshot:Co,ElementSnapshot:Mo,SelectorExecutor:Ho},Sc="%testCafeDriver%",Ic="%testCafeIframeDriver%",Tc="%ScriptExecutionBarrier%",bc="%testCafeEmbeddingUtils%",xc=o.nativeMethods,Wc=o.EVENTS.evalIframeScript;xc.objectDefineProperty(Ac,Sc,{configurable:!0,value:uc}),xc.objectDefineProperty(Ac,Ic,{configurable:!0,value:_c}),xc.objectDefineProperty(Ac,Tc,{configurable:!0,value:Lo}),xc.objectDefineProperty(Ac,bc,{configurable:!0,value:Cc}),o.on(Wc,function(t){return Mc(xc.contentWindowGetter.call(t.iframe))})}(Ac["%hammerhead%"],Ac["%hammerhead%"].Promise,Ac["%testCafeCore%"],Ac["%testCafeAutomation%"],Ac["%testCafeUI%"])}(window);